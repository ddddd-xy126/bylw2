# 前后端分离架构迁移说明

## 📌 核心概念

**前后端分离** = 前端项目 + 后端项目 **完全独立**

```
当前架构：
前端 (Vue3) → json-server (Mock) → db.json

目标架构：
前端 (Vue3) ←→ HTTP API ←→ 后端 (Express + MySQL)
    ↓                           ↓
独立部署                     独立部署
```

---

## 🎯 为什么前后端分离迁移很简单？

### 1. 项目结构已经分离 ✅

```
questionnaire-system/
├── client/          # ✅ 前端项目（已独立）
│   ├── src/
│   ├── package.json
│   └── vite.config.js
│
└── (新建) server/   # 🆕 后端项目（需创建）
    ├── app.js
    ├── package.json
    └── ...
```

**关键**：两个项目有**各自的 package.json**，互不依赖！

### 2. API 调用已抽象化 ✅

所有 API 调用都在 `client/src/api/` 目录：
- ✏️ 只需修改 `index.js` 中的 `baseURL`
- ✏️ 其他业务代码**无需改动**

### 3. 数据结构已设计 ✅

`db.json` 可直接映射到 MySQL 表：
- users → User 模型
- surveys → Survey 模型
- answers → Answer 模型

---

## 🔧 迁移步骤（3 步搞定）

### Step 1: 创建独立的后端项目 (1天)

```bash
cd questionnaire-system
mkdir server
cd server
npm init -y  # 创建独立的 package.json
npm install express mysql2 sequelize jsonwebtoken bcryptjs cors dotenv
```

**目录结构**：
```
server/
├── app.js              # Express 入口
├── package.json        # 后端依赖
├── .env                # 环境变量
├── config/
│   └── database.js     # 数据库配置
├── models/             # Sequelize 模型
├── controllers/        # 业务逻辑
├── routes/             # 路由定义
└── middleware/         # JWT 认证等
```

### Step 2: 修改前端 API 配置 (10分钟)

**方式 A：使用 Vite Proxy（推荐）**

`client/vite.config.js`：
```javascript
export default defineConfig({
  server: {
    proxy: {
      '/api': {
        target: 'http://localhost:3000',  // 后端地址
        changeOrigin: true
      }
    }
  }
})
```

`client/src/api/index.js`：
```javascript
const instance = axios.create({ 
  baseURL: "/api",  // 使用相对路径，Vite 会代理
  timeout: 10000 
});
```

**方式 B：直接调用（需配置 CORS）**

`client/src/api/index.js`：
```javascript
const instance = axios.create({ 
  baseURL: "http://localhost:3000/api",  // 直接调用后端
  timeout: 10000 
});
```

### Step 3: 分别启动前后端 (2个终端)

```bash
# 终端 1：启动后端
cd server
npm run dev
# 运行在 http://localhost:3000

# 终端 2：启动前端
cd client  
npm run dev
# 运行在 http://localhost:5173
```

访问 `http://localhost:5173` 即可！

---

## 📊 前端需要改哪些文件？

### 必改文件（仅 2-3 个）

1. **`client/vite.config.js`** - 配置代理
2. **`client/src/api/index.js`** - 修改 baseURL
3. **`client/.env.development`** - 配置 API URL（可选）

### 可选优化（API 调用简化）

由于后端已处理所有逻辑，前端 API 可以大幅简化：

**之前（json-server）**：
```javascript
// 前端需要自己查询、验证、处理
export async function login(data) {
  const users = await apiClient.get('/users');
  const user = users.find(u => u.username === data.username);
  // ... 很多逻辑
}
```

**现在（真实后端）**：
```javascript
// 后端已处理，前端只需调用
export async function login(data) {
  return await apiClient.post('/auth/login', data);
}
```

---

## 🚀 开发工作流

### 开发环境

```bash
# 前端开发者
cd client
npm run dev

# 后端开发者  
cd server
npm run dev

# 可以独立开发，通过 API 接口协作
```

### 生产部署

**前端**：
```bash
cd client
npm run build
# 输出到 dist/，部署到 Nginx/CDN
```

**后端**：
```bash
cd server
npm install --production
pm2 start app.js
# 部署到云服务器
```

---

## ✅ 前后端分离的优势

| 优势 | 说明 |
|------|------|
| 🔀 **独立开发** | 前后端可并行开发，互不干扰 |
| 📦 **独立部署** | 前端部署到 CDN，后端部署到服务器 |
| 🔄 **技术栈灵活** | 可随时更换前端框架或后端语言 |
| 🧪 **易于测试** | 可单独测试前端或后端 |
| 👥 **团队协作** | 前后端团队职责清晰 |
| 📈 **易于扩展** | 前后端可独立扩容 |

---

## ❓ 常见疑问

### Q: 前后端分离会很复杂吗？
**A**: 不会！实际上更简单。前端只管界面，后端只管数据，职责清晰。

### Q: 跨域问题怎么解决？
**A**: 
- 开发环境：使用 Vite proxy（配置一次即可）
- 生产环境：后端配置 CORS，或使用 Nginx 反向代理

### Q: 前后端如何通信？
**A**: 通过 RESTful API（HTTP 请求），前端发请求，后端返回 JSON。

### Q: 需要学习什么新技术吗？
**A**: 不需要！后端使用 Express（你已经在迁移指南里了），前端继续用 Vue3。

### Q: 迁移需要多久？
**A**: 
- 搭建后端：1-2 天
- 前端适配：半天
- 测试调试：1-2 天
- **总计：3-5 天**

---

## 🎯 快速检查清单

开始迁移前，确保理解以下要点：

- [ ] 前端和后端是**两个独立的项目**
- [ ] 各自有**独立的 package.json**
- [ ] 通过 **HTTP API** 通信
- [ ] 前端只需修改 **API 地址**
- [ ] 后端负责**所有业务逻辑**
- [ ] 可以**分别启动**和**独立部署**

---

## 📚 相关文档

- 详细迁移步骤：`MIGRATION_GUIDE.md`
- API 接口文档：建议使用 Apifox/Swagger
- 部署文档：Nginx + PM2 配置

**总结**：前后端分离迁移不仅简单，而且是现代 Web 开发的标准做法！
