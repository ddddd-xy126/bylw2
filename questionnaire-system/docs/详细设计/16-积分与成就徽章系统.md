# ç§¯åˆ†ä¸æˆå°±å¾½ç« ç³»ç»Ÿ

## åŠŸèƒ½æè¿°

ç§¯åˆ†ä¸æˆå°±å¾½ç« ç³»ç»Ÿæ˜¯é—®å·å¹³å°çš„æ¿€åŠ±æœºåˆ¶,é€šè¿‡ç»™äºˆç”¨æˆ·ç§¯åˆ†å¥–åŠ±å’Œè§£é”æˆå°±å¾½ç« ,é¼“åŠ±ç”¨æˆ·ç§¯æå‚ä¸é—®å·å¡«å†™ã€åˆ›å»ºé—®å·ã€å®Œå–„èµ„æ–™ç­‰è¡Œä¸º,æå‡ç”¨æˆ·æ´»è·ƒåº¦å’Œå¹³å°ç²˜æ€§ã€‚ç³»ç»ŸåŒ…å«ç§¯åˆ†è·å–ã€ç§¯åˆ†å†å²è®°å½•ã€ç­‰çº§è®¡ç®—ã€æˆå°±å¾½ç« è§£é”ç­‰åŠŸèƒ½æ¨¡å—ã€‚

ä¸»è¦åŠŸèƒ½ç‰¹æ€§:
- **ç§¯åˆ†è·å–**: ç”¨æˆ·é€šè¿‡æ³¨å†Œã€å®Œæˆé—®å·ã€åˆ›å»ºé—®å·ã€å®Œå–„èµ„æ–™ã€æ¯æ—¥ç™»å½•ã€äº’åŠ¨è¡Œä¸ºç­‰å¤šç§æ–¹å¼è·å¾—ç§¯åˆ†
- **ç§¯åˆ†å†å²**: è®°å½•æ¯æ¬¡ç§¯åˆ†å˜åŠ¨çš„è¯¦ç»†ä¿¡æ¯,åŒ…æ‹¬æ—¶é—´ã€æ•°é‡ã€åŸå› ã€ç±»å‹(è·å¾—/æ¶ˆè´¹)
- **ç­‰çº§ç³»ç»Ÿ**: æ ¹æ®ç§¯åˆ†è‡ªåŠ¨è®¡ç®—ç”¨æˆ·ç­‰çº§,ç­‰çº§ = âŒŠç§¯åˆ† Ã· 500âŒ‹ + 1
- **æˆå°±å¾½ç« **: å®Œæˆç‰¹å®šä»»åŠ¡è§£é”æˆå°±å¾½ç« ,è§£é”æ—¶è‡ªåŠ¨è·å¾—é¢å¤–ç§¯åˆ†å¥–åŠ±
- **å¾½ç« åˆ†ç±»**: æ¯æ—¥ç™»å½•ã€å®Œæˆé—®å·ã€åˆ›å»ºå‘å¸ƒã€äº’åŠ¨è¡Œä¸ºã€ç§¯åˆ†ç­‰çº§ç­‰å¤šç§ç±»å‹
- **è¿›åº¦è¿½è¸ª**: æœªè§£é”å¾½ç« æ˜¾ç¤ºå½“å‰è¿›åº¦å’Œè¾¾æˆè¦æ±‚
- **å¯è§†åŒ–å±•ç¤º**: ä¸ªäººæˆå°±é¡µé¢å±•ç¤ºç§¯åˆ†æ€»æ•°ã€å·²å®Œæˆé—®å·ã€å·²è§£é”å¾½ç« ç­‰ç»Ÿè®¡æ•°æ®

## ä»£ç é€»è¾‘

### 1. ç§¯åˆ†è·å–è§„åˆ™

ç³»ç»Ÿè®¾è®¡äº†ä¸°å¯Œçš„ç§¯åˆ†è·å–é€”å¾„:

**æ³¨å†Œä¸ç™»å½•**:
- æ³¨å†Œæ–°è´¦å·: 100ç§¯åˆ†
- æ¯æ—¥é¦–æ¬¡ç™»å½•: 5ç§¯åˆ†
- è¿ç»­ç™»å½•3å¤©: é¢å¤–5ç§¯åˆ†
- è¿ç»­ç™»å½•7å¤©: é¢å¤–10ç§¯åˆ†
- è¿ç»­ç™»å½•30å¤©: é¢å¤–50ç§¯åˆ†

**é—®å·ç›¸å…³**:
- å®Œæˆé—®å·: 10ç§¯åˆ†
- åˆ›å»ºé—®å·(è‰ç¨¿): 3ç§¯åˆ†
- æäº¤å®¡æ ¸: 5ç§¯åˆ†
- å®¡æ ¸é€šè¿‡: é¢å¤–ç§¯åˆ†
- é¦–æ¬¡å®Œæˆé—®å·: é¢å¤–20ç§¯åˆ†

**äº’åŠ¨è¡Œä¸º**:
- æ”¶è—é—®å·: 3ç§¯åˆ†
- å‘è¡¨è¯„è®º: 5ç§¯åˆ†
- åˆ†äº«é—®å·: 5ç§¯åˆ†

**èµ„æ–™å®Œå–„**:
- é¦–æ¬¡å®Œå–„æ‰€æœ‰å¿…å¡«ä¿¡æ¯: 15ç§¯åˆ†
- å¿…å¡«ä¿¡æ¯åŒ…æ‹¬:ç”¨æˆ·åã€é‚®ç®±ã€æ‰‹æœºã€æ€§åˆ«ã€å¹´é¾„ã€åŸå¸‚ã€èŒä¸šã€ç®€ä»‹ã€æ ‡ç­¾

### 2. ç§¯åˆ†è®°å½•æµç¨‹

æ¯æ¬¡ç§¯åˆ†å˜åŠ¨éƒ½ä¼šåˆ›å»º PointHistory è®°å½•:
1. ç”¨æˆ·æ‰§è¡ŒæŸä¸ªæ“ä½œ(å¦‚å®Œæˆé—®å·)
2. åç«¯åœ¨æ•°æ®åº“äº‹åŠ¡ä¸­æ‰§è¡Œ:
   - è°ƒç”¨ `user.increment('points', {by: pointsEarned})` å¢åŠ ç”¨æˆ·ç§¯åˆ†
   - åˆ›å»º PointHistory è®°å½•:
     - `id`: å”¯ä¸€æ ‡è¯† `ph_${Date.now()}`
     - `userId`: ç”¨æˆ·ID
     - `points`: ç§¯åˆ†æ•°é‡
     - `reason`: åŸå› æè¿°,å¦‚"å®Œæˆé—®å·ã€Šxxxã€‹"
     - `type`: ç±»å‹,`earn`(è·å¾—)æˆ–`spend`(æ¶ˆè´¹)
     - `createdAt`: åˆ›å»ºæ—¶é—´(è‡ªåŠ¨ç”Ÿæˆ)
3. æäº¤äº‹åŠ¡,ç¡®ä¿ç§¯åˆ†å’Œå†å²è®°å½•çš„ä¸€è‡´æ€§

### 3. ç­‰çº§è®¡ç®—

ç­‰çº§æ ¹æ®ç§¯åˆ†è‡ªåŠ¨è®¡ç®—:
- è®¡ç®—å…¬å¼: `ç­‰çº§ = Math.floor(ç§¯åˆ† / 500) + 1`
- ç­‰çº§å¯¹åº”å…³ç³»:
  - 1çº§: 0-499ç§¯åˆ† ğŸ¯
  - 2çº§: 500-999ç§¯åˆ† ğŸ¥‰
  - 3çº§: 1000-1499ç§¯åˆ† ğŸ¥ˆ
  - 4çº§: 1500-1999ç§¯åˆ† ğŸ¥‡
  - 5çº§: 2000-2499ç§¯åˆ† ğŸ†
  - 10çº§: 4500-4999ç§¯åˆ† ğŸ‘‘
- å‰ç«¯è®¡ç®—:`const level = Math.floor(points / 500) + 1`

### 4. æˆå°±å¾½ç« ç³»ç»Ÿ

**å¾½ç« å®šä¹‰** (Badgeè¡¨):
- `id`: å¾½ç« å”¯ä¸€æ ‡è¯†
- `name`: å¾½ç« åç§°,å¦‚"æ–°æ‰‹ä¸Šè·¯"
- `description`: å¾½ç« æè¿°,å¦‚"å®Œæˆé¦–æ¬¡é—®å·"
- `icon`: å¾½ç« å›¾æ ‡
- `type`: å¾½ç« ç±»å‹,å¦‚`survey_count`ã€`login_count`ã€`create_count`ç­‰
- `requirement`: è¾¾æˆè¦æ±‚æ•°é‡,å¦‚å®Œæˆ10ä»½é—®å·
- `points`: è§£é”å¾½ç« å¥–åŠ±çš„ç§¯åˆ†

**å¾½ç« è§£é”é€»è¾‘**:
1. ç³»ç»Ÿæ£€æµ‹ç”¨æˆ·è¡Œä¸ºç»Ÿè®¡æ•°æ®
2. åˆ¤æ–­æ˜¯å¦æ»¡è¶³æŸä¸ªå¾½ç« çš„ `requirement` è¦æ±‚
3. å¦‚æ»¡è¶³ä¸”æœªè§£é”,åˆ™:
   - åˆ›å»ºç”¨æˆ·å¾½ç« å…³è”è®°å½•
   - å¥–åŠ±å¯¹åº”çš„ç§¯åˆ†(`badge.points`)
   - åˆ›å»ºç§¯åˆ†å†å²è®°å½•
   - å‰ç«¯æ˜¾ç¤ºè§£é”åŠ¨ç”»å’Œæç¤º

**å¾½ç« ç±»å‹**:
- `login_count`: ç™»å½•æ¬¡æ•°
- `continuous_login`: è¿ç»­ç™»å½•å¤©æ•°
- `survey_count`: å®Œæˆé—®å·æ•°é‡
- `create_count`: åˆ›å»ºé—®å·æ•°é‡
- `publish_count`: å‘å¸ƒé—®å·æ•°é‡
- `approved_count`: å®¡æ ¸é€šè¿‡æ•°é‡
- `favorite_count`: æ”¶è—æ¬¡æ•°
- `comment_count`: è¯„è®ºæ¬¡æ•°
- `share_count`: åˆ†äº«æ¬¡æ•°
- `profile_complete`: èµ„æ–™å®Œæ•´åº¦
- `total_points`: ç§¯åˆ†æ€»æ•°
- `user_level`: ç”¨æˆ·ç­‰çº§

### 5. æˆå°±é¡µé¢å±•ç¤º

**ç»Ÿè®¡å¡ç‰‡**:
- ç§¯åˆ†æ€»æ•°: ä»ç”¨æˆ·èµ„æ–™çš„ `points` å­—æ®µè·å–
- å·²å®Œæˆé—®å·: æŸ¥è¯¢ Answer è¡¨ç»Ÿè®¡
- å·²è·å¾—å¾½ç« : ç»Ÿè®¡å·²è§£é”å¾½ç« æ•°é‡

**å¾½ç« åˆ—è¡¨**:
- å·²è§£é”å¾½ç« : æ˜¾ç¤ºå¾½ç« å›¾æ ‡ã€åç§°ã€æè¿°ã€è·å¾—ç§¯åˆ†
- æœªè§£é”å¾½ç« : æ˜¾ç¤ºé”å®šå›¾æ ‡ã€å½“å‰è¿›åº¦ã€è¾¾æˆè¦æ±‚
- ç­›é€‰åŠŸèƒ½: åˆ‡æ¢"å·²è§£é”"å’Œ"æœªè§£é”"è§†å›¾

**è¿›åº¦è®¡ç®—**:
- æ ¹æ®å¾½ç« ç±»å‹ä»ç”¨æˆ·ç»Ÿè®¡æ•°æ®è·å–å½“å‰è¿›åº¦
- æ˜¾ç¤ºè¿›åº¦æ¡: `å½“å‰è¿›åº¦ / è¦æ±‚æ•°é‡`
- ä¾‹å¦‚"å®Œæˆ10ä»½é—®å·"å¾½ç« ,æ˜¾ç¤º"5/10"

### 6. ç§¯åˆ†å†å²æŸ¥è¯¢

åç«¯æä¾› `getPointHistory` æ¥å£:
- æŒ‰ç”¨æˆ·IDç­›é€‰ç§¯åˆ†å†å²è®°å½•
- æ”¯æŒåˆ†é¡µæŸ¥è¯¢(page, limit)
- æŒ‰åˆ›å»ºæ—¶é—´å€’åºæ’åˆ—(æœ€æ–°è®°å½•åœ¨å‰)
- è¿”å›å†å²è®°å½•åˆ—è¡¨ã€æ€»æ•°ã€é¡µç ã€æ€»é¡µæ•°

å‰ç«¯å±•ç¤º:
- æ—¶é—´è½´å½¢å¼å±•ç¤ºç§¯åˆ†å˜åŠ¨å†å²
- æ¯æ¡è®°å½•æ˜¾ç¤º:æ—¶é—´ã€ç§¯åˆ†æ•°é‡ã€åŸå› ã€ç±»å‹(è·å¾—/æ¶ˆè´¹)
- è·å¾—ç§¯åˆ†æ˜¾ç¤ºç»¿è‰²"+XX",æ¶ˆè´¹ç§¯åˆ†æ˜¾ç¤ºçº¢è‰²"-XX"

## æ—¶åºå›¾æè¿°

### ç”¨æˆ·æ³¨å†Œè·å¾—ç§¯åˆ†

```
ç”¨æˆ· â†’ æ³¨å†Œé¡µé¢: å¡«å†™æ³¨å†Œä¿¡æ¯å¹¶æäº¤
æ³¨å†Œé¡µé¢ â†’ APIå±‚(auth.js): registerApi({username, email, password})
APIå±‚ â†’ åç«¯è·¯ç”±: POST /auth/register
åç«¯è·¯ç”± â†’ authController.register: è°ƒç”¨æ³¨å†Œæ–¹æ³•
authController.register â†’ Userè¡¨: æŸ¥è¯¢ç”¨æˆ·åæ˜¯å¦å­˜åœ¨
Userè¡¨ â†’ authController.register: è¿”å›æŸ¥è¯¢ç»“æœ
authController.register â†’ Userè¡¨: createåˆ›å»ºç”¨æˆ·(points: 100)
authController.register â†’ PointHistoryè¡¨: createè®°å½•("æ³¨å†Œå¥–åŠ±", 100ç§¯åˆ†)
authController.register â†’ authController.register: ç”ŸæˆJWT token
authController.register â†’ åç«¯è·¯ç”±: è¿”å›{token, user}
åç«¯è·¯ç”± â†’ APIå±‚: è¿”å›æ³¨å†Œç»“æœ
APIå±‚ â†’ æ³¨å†Œé¡µé¢: è¿”å›ç”¨æˆ·ä¿¡æ¯å’Œtoken
æ³¨å†Œé¡µé¢ â†’ ç”¨æˆ·: æ˜¾ç¤º"æ³¨å†ŒæˆåŠŸ,è·å¾—100ç§¯åˆ†"æç¤º
æ³¨å†Œé¡µé¢ â†’ Pinia store: ä¿å­˜ç”¨æˆ·ä¿¡æ¯å’Œtoken
æ³¨å†Œé¡µé¢ â†’ é¦–é¡µ: è·³è½¬åˆ°é¦–é¡µ
```

### å®Œæˆé—®å·è·å¾—ç§¯åˆ†

```
ç”¨æˆ· â†’ ç­”é¢˜é¡µé¢: å®Œæˆé—®å·å¹¶ç‚¹å‡»"æäº¤"
ç­”é¢˜é¡µé¢ â†’ APIå±‚(survey.js): submitSurveyApi(id, answers)
APIå±‚ â†’ åç«¯è·¯ç”±: POST /answers
åç«¯è·¯ç”± â†’ answerController.submitAnswer: è°ƒç”¨æäº¤ç­”æ¡ˆæ–¹æ³•
answerController.submitAnswer â†’ æ•°æ®åº“: å¼€å¯äº‹åŠ¡
answerController.submitAnswer â†’ Surveyè¡¨: æŸ¥è¯¢é—®å·æ˜¯å¦å­˜åœ¨
answerController.submitAnswer â†’ Answerè¡¨: createåˆ›å»ºç­”æ¡ˆè®°å½•
answerController.submitAnswer â†’ Surveyè¡¨: incrementå¢åŠ participantCount
answerController.submitAnswer â†’ Userè¡¨: incrementå¢åŠ ç§¯åˆ†(points + 10)
answerController.submitAnswer â†’ PointHistoryè¡¨: createè®°å½•("å®Œæˆé—®å·ã€Šxxxã€‹", 10ç§¯åˆ†)
answerController.submitAnswer â†’ æ•°æ®åº“: æäº¤äº‹åŠ¡
answerController.submitAnswer â†’ åç«¯è·¯ç”±: è¿”å›{answer, pointsEarned: 10}
åç«¯è·¯ç”± â†’ APIå±‚: è¿”å›æäº¤ç»“æœ
APIå±‚ â†’ ç­”é¢˜é¡µé¢: è¿”å›{pointsEarned: 10}
ç­”é¢˜é¡µé¢ â†’ Pinia store: æ›´æ–°ç”¨æˆ·ç§¯åˆ†(points + 10)
ç­”é¢˜é¡µé¢ â†’ ç”¨æˆ·: æ˜¾ç¤º"é—®å·æäº¤æˆåŠŸ!è·å¾—10ç§¯åˆ†"æç¤º
```

### è§£é”æˆå°±å¾½ç« è·å¾—å¥–åŠ±

```
ç”¨æˆ· â†’ ç³»ç»Ÿ: å®Œæˆç¬¬10ä»½é—®å·
ç³»ç»Ÿ â†’ å¾½ç« æ£€æµ‹æœåŠ¡: æ£€æµ‹ç”¨æˆ·ç»Ÿè®¡æ•°æ®
å¾½ç« æ£€æµ‹æœåŠ¡ â†’ Answerè¡¨: æŸ¥è¯¢ç”¨æˆ·ç­”é¢˜æ•°é‡
Answerè¡¨ â†’ å¾½ç« æ£€æµ‹æœåŠ¡: è¿”å›count = 10
å¾½ç« æ£€æµ‹æœåŠ¡ â†’ Badgeè¡¨: æŸ¥è¯¢"å®Œæˆ10ä»½é—®å·"å¾½ç« 
Badgeè¡¨ â†’ å¾½ç« æ£€æµ‹æœåŠ¡: è¿”å›å¾½ç« (requirement: 10, points: 20)
å¾½ç« æ£€æµ‹æœåŠ¡ â†’ å¾½ç« æ£€æµ‹æœåŠ¡: åˆ¤æ–­10 >= 10,æ»¡è¶³è§£é”æ¡ä»¶
å¾½ç« æ£€æµ‹æœåŠ¡ â†’ UserBadgeè¡¨: æ£€æŸ¥æ˜¯å¦å·²è§£é”
UserBadgeè¡¨ â†’ å¾½ç« æ£€æµ‹æœåŠ¡: è¿”å›æœªè§£é”
å¾½ç« æ£€æµ‹æœåŠ¡ â†’ æ•°æ®åº“: å¼€å¯äº‹åŠ¡
å¾½ç« æ£€æµ‹æœåŠ¡ â†’ UserBadgeè¡¨: createåˆ›å»ºç”¨æˆ·å¾½ç« å…³è”
å¾½ç« æ£€æµ‹æœåŠ¡ â†’ Userè¡¨: incrementå¢åŠ ç§¯åˆ†(points + 20)
å¾½ç« æ£€æµ‹æœåŠ¡ â†’ PointHistoryè¡¨: createè®°å½•("è§£é”å¾½ç« 'é—®å·è¾¾äºº'", 20ç§¯åˆ†)
å¾½ç« æ£€æµ‹æœåŠ¡ â†’ æ•°æ®åº“: æäº¤äº‹åŠ¡
å¾½ç« æ£€æµ‹æœåŠ¡ â†’ å‰ç«¯: å‘é€å¾½ç« è§£é”äº‹ä»¶
å‰ç«¯ â†’ ç”¨æˆ·: æ˜¾ç¤ºå¾½ç« è§£é”åŠ¨ç”»å’Œ"æ­å–œè§£é”'é—®å·è¾¾äºº'å¾½ç« !è·å¾—20ç§¯åˆ†"æç¤º
```

### æŸ¥çœ‹ç§¯åˆ†å†å²

```
ç”¨æˆ· â†’ ä¸ªäººæˆå°±é¡µé¢: è®¿é—®ä¸ªäººæˆå°±é¡µé¢
ä¸ªäººæˆå°±é¡µé¢ â†’ APIå±‚(user.js): getPointHistoryApi(userId)
APIå±‚ â†’ åç«¯è·¯ç”±: GET /users/:id/point-history
åç«¯è·¯ç”± â†’ userController.getPointHistory: è°ƒç”¨è·å–ç§¯åˆ†å†å²æ–¹æ³•
userController.getPointHistory â†’ PointHistoryè¡¨: findAndCountAll(where: {userId}, order: DESC)
PointHistoryè¡¨ â†’ userController.getPointHistory: è¿”å›å†å²è®°å½•åˆ—è¡¨
userController.getPointHistory â†’ åç«¯è·¯ç”±: è¿”å›{history, total, page, totalPages}
åç«¯è·¯ç”± â†’ APIå±‚: è¿”å›ç§¯åˆ†å†å²æ•°æ®
APIå±‚ â†’ ä¸ªäººæˆå°±é¡µé¢: è¿”å›å†å²è®°å½•åˆ—è¡¨
ä¸ªäººæˆå°±é¡µé¢ â†’ ä¸ªäººæˆå°±é¡µé¢: æ¸²æŸ“æ—¶é—´è½´å±•ç¤ºç§¯åˆ†å˜åŠ¨
ä¸ªäººæˆå°±é¡µé¢ â†’ ç”¨æˆ·: æ˜¾ç¤ºç§¯åˆ†å†å²åˆ—è¡¨(æ—¶é—´ã€ç§¯åˆ†ã€åŸå› )
```

### æŸ¥çœ‹æˆå°±å¾½ç« 

```
ç”¨æˆ· â†’ ä¸ªäººæˆå°±é¡µé¢: è®¿é—®æˆå°±å¾½ç« é¡µé¢
ä¸ªäººæˆå°±é¡µé¢ â†’ APIå±‚(badges.js): getBadgesApi()
APIå±‚ â†’ åç«¯è·¯ç”±: GET /badges
åç«¯è·¯ç”± â†’ Badgeè¡¨: findAll()æŸ¥è¯¢æ‰€æœ‰å¾½ç« å®šä¹‰
Badgeè¡¨ â†’ åç«¯è·¯ç”±: è¿”å›æ‰€æœ‰å¾½ç« åˆ—è¡¨
åç«¯è·¯ç”± â†’ APIå±‚: è¿”å›å¾½ç« æ•°æ®
APIå±‚ â†’ ä¸ªäººæˆå°±é¡µé¢: è¿”å›å¾½ç« åˆ—è¡¨allBadges
ä¸ªäººæˆå°±é¡µé¢ â†’ APIå±‚(user.js): getUserBadgesApi(userId)
APIå±‚ â†’ åç«¯è·¯ç”±: GET /users/:id/badges
åç«¯è·¯ç”± â†’ UserBadgeè¡¨: findAll(where: {userId})
UserBadgeè¡¨ â†’ åç«¯è·¯ç”±: è¿”å›ç”¨æˆ·å·²è§£é”å¾½ç« IDåˆ—è¡¨
åç«¯è·¯ç”± â†’ APIå±‚: è¿”å›userUnlockedBadgeIds
APIå±‚ â†’ ä¸ªäººæˆå°±é¡µé¢: è¿”å›å·²è§£é”å¾½ç« åˆ—è¡¨
ä¸ªäººæˆå°±é¡µé¢ â†’ ä¸ªäººæˆå°±é¡µé¢: è®¡ç®—å·²è§£é”å’Œæœªè§£é”å¾½ç« 
ä¸ªäººæˆå°±é¡µé¢ â†’ ä¸ªäººæˆå°±é¡µé¢: æ ¹æ®badgeFilterç­›é€‰æ˜¾ç¤º
ä¸ªäººæˆå°±é¡µé¢ â†’ ç”¨æˆ·: æ¸²æŸ“å¾½ç« ç½‘æ ¼(å·²è§£é”å½©è‰²,æœªè§£é”ç°è‰²+é”)
ç”¨æˆ· â†’ ä¸ªäººæˆå°±é¡µé¢: ç‚¹å‡»"æœªè§£é”"ç­›é€‰
ä¸ªäººæˆå°±é¡µé¢ â†’ ä¸ªäººæˆå°±é¡µé¢: æ˜¾ç¤ºæœªè§£é”å¾½ç« å’Œå½“å‰è¿›åº¦
ä¸ªäººæˆå°±é¡µé¢ â†’ ç”¨æˆ·: æ˜¾ç¤º"è¿›åº¦:5/10"ç­‰è¿›åº¦ä¿¡æ¯
```

## æ¥å£å®šä¹‰

### 1. è·å–ç§¯åˆ†å†å²

**æ¥å£**: `GET /users/:id/point-history`

**è¯·æ±‚å¤´**: `Authorization: Bearer <token>`

**æŸ¥è¯¢å‚æ•°**:
- `page` (number, å¯é€‰) - é¡µç ,é»˜è®¤1
- `limit` (number, å¯é€‰) - æ¯é¡µæ•°é‡,é»˜è®¤20

**å“åº”æ•°æ®**:
```json
{
  "success": true,
  "data": {
    "history": [
      {
        "id": "ph_1701234567890",
        "userId": "user_123",
        "points": 10,
        "reason": "å®Œæˆé—®å·ã€Šç”¨æˆ·ä½“éªŒè°ƒæŸ¥ã€‹",
        "type": "earn",
        "createdAt": "2024-01-15T10:30:00.000Z"
      },
      {
        "id": "ph_1701234567891",
        "userId": "user_123",
        "points": 5,
        "reason": "æäº¤é—®å·å®¡æ ¸",
        "type": "earn",
        "createdAt": "2024-01-15T09:00:00.000Z"
      }
    ],
    "total": 50,
    "page": 1,
    "totalPages": 3
  }
}
```

### 2. è·å–æ‰€æœ‰å¾½ç« å®šä¹‰

**æ¥å£**: `GET /badges`

**å“åº”æ•°æ®**:
```json
[
  {
    "id": "badge_survey_10",
    "name": "é—®å·è¾¾äºº",
    "description": "å®Œæˆ10ä»½é—®å·",
    "icon": "ğŸ¯",
    "type": "survey_count",
    "requirement": 10,
    "points": 20
  },
  {
    "id": "badge_continuous_7",
    "name": "åšæŒä¸æ‡ˆ",
    "description": "è¿ç»­ç™»å½•7å¤©",
    "icon": "ğŸ”¥",
    "type": "continuous_login",
    "requirement": 7,
    "points": 15
  },
  {
    "id": "badge_create_5",
    "name": "åˆ›ä½œæ–°æ˜Ÿ",
    "description": "åˆ›å»º5ä»½é—®å·",
    "icon": "âœ¨",
    "type": "create_count",
    "requirement": 5,
    "points": 25
  }
]
```

### 3. è·å–ç”¨æˆ·å·²è§£é”å¾½ç« 

**æ¥å£**: `GET /users/:id/badges`

**è¯·æ±‚å¤´**: `Authorization: Bearer <token>`

**å“åº”æ•°æ®**:
```json
{
  "success": true,
  "data": [
    "badge_survey_10",
    "badge_continuous_7",
    "badge_create_5"
  ]
}
```

### 4. ç”¨æˆ·æ³¨å†Œ(å«åˆå§‹ç§¯åˆ†)

**æ¥å£**: `POST /auth/register`

**è¯·æ±‚å‚æ•°**:
```json
{
  "username": "zhangsan",
  "email": "zhangsan@example.com",
  "password": "password123",
  "nickname": "å¼ ä¸‰"
}
```

**å“åº”æ•°æ®**:
```json
{
  "success": true,
  "message": "æ³¨å†ŒæˆåŠŸ",
  "data": {
    "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
    "user": {
      "id": "user_123",
      "username": "zhangsan",
      "email": "zhangsan@example.com",
      "nickname": "å¼ ä¸‰",
      "points": 100,
      "role": "user",
      "avatar": "https://api.dicebear.com/7.x/avataaars/svg?seed=zhangsan"
    }
  }
}
```

## å…³é”®ä»£ç 

### åç«¯ - æ³¨å†Œèµ é€ç§¯åˆ† (authController.js)

```javascript
exports.register = async (req, res, next) => {
  try {
    const { username, email, password, nickname } = req.body;

    // æ£€æŸ¥ç”¨æˆ·åæ˜¯å¦å·²å­˜åœ¨
    const existingUsername = await User.findOne({
      where: { username },
    });

    if (existingUsername) {
      return res.status(400).json({
        success: false,
        message: "ç”¨æˆ·åå·²å­˜åœ¨ï¼Œè¯·é‡æ–°è¾“å…¥",
      });
    }

    // åˆ›å»ºç”¨æˆ·,åˆå§‹ç§¯åˆ†100
    const user = await User.create({
      id: Date.now().toString(),
      username,
      email: email || `${username}@example.com`,
      password,
      nickname: nickname || username,
      points: 100, // æ³¨å†Œèµ é€ 100 ç§¯åˆ†
      avatar: `https://api.dicebear.com/7.x/avataaars/svg?seed=${username}`,
    });

    // è®°å½•ç§¯åˆ†å†å²
    await PointHistory.create({
      id: `ph_${Date.now()}`,
      userId: user.id,
      points: 100,
      reason: "æ³¨å†Œå¥–åŠ±",
      type: "earn",
    });

    // ç”Ÿæˆ Token
    const token = jwt.sign(
      { id: user.id, role: user.role },
      jwtConfig.secret,
      { expiresIn: jwtConfig.expiresIn }
    );

    res.status(201).json({
      success: true,
      message: "æ³¨å†ŒæˆåŠŸ",
      data: {
        token,
        user: user.toSafeObject(),
      },
    });
  } catch (error) {
    next(error);
  }
};
```

### åç«¯ - å®Œæˆé—®å·å¥–åŠ±ç§¯åˆ† (answerController.js)

```javascript
exports.submitAnswer = async (req, res, next) => {
  const t = await sequelize.transaction();

  try {
    const { surveyId, answers, duration, score, result } = req.body;

    // æ£€æŸ¥é—®å·æ˜¯å¦å­˜åœ¨
    const survey = await Survey.findByPk(surveyId);
    if (!survey) {
      await t.rollback();
      return res.status(404).json({
        success: false,
        message: "é—®å·ä¸å­˜åœ¨",
      });
    }

    // åˆ›å»ºç­”æ¡ˆè®°å½•
    const answer = await Answer.create(
      {
        id: Date.now().toString(),
        userId: req.user.id,
        surveyId,
        answers,
        score,
        result,
        duration,
        submittedAt: new Date(),
      },
      { transaction: t }
    );

    // æ›´æ–°é—®å·ç»Ÿè®¡
    await survey.increment("participantCount", { transaction: t });
    await survey.increment("responseCount", { transaction: t });

    // å¥–åŠ±ç§¯åˆ†
    const pointsEarned = 10;
    await req.user.increment("points", { by: pointsEarned, transaction: t });
    await PointHistory.create(
      {
        id: `ph_${Date.now()}`,
        userId: req.user.id,
        points: pointsEarned,
        reason: `å®Œæˆé—®å·ã€Š${survey.title}ã€‹`,
        type: "earn",
      },
      { transaction: t }
    );

    await t.commit();

    res.status(201).json({
      success: true,
      message: "ç­”æ¡ˆæäº¤æˆåŠŸ",
      data: {
        answer,
        pointsEarned, // è¿”å›è·å¾—çš„ç§¯åˆ†
      },
    });
  } catch (error) {
    await t.rollback();
    next(error);
  }
};
```

### åç«¯ - åˆ›å»ºé—®å·å¥–åŠ±ç§¯åˆ† (surveyController.js)

```javascript
exports.createSurvey = async (req, res, next) => {
  const t = await sequelize.transaction();

  try {
    const {
      title,
      description,
      category,
      questionList,
      status,
    } = req.body;

    const survey = await Survey.create(
      {
        id: Date.now().toString(),
        userId: req.user.id,
        title,
        description,
        category,
        questionList,
        status: status || "draft",
        questions: questionList?.length || 0,
      },
      { transaction: t }
    );

    // ç§¯åˆ†å¥–åŠ±é€»è¾‘
    const PointHistory = require("../models").PointHistory;
    let pointsEarned = 0;
    let rewardReason = "";

    if (status === "draft") {
      // åˆ›å»ºé—®å·ï¼ˆè‰ç¨¿ï¼‰: è·å¾— 3 ç§¯åˆ†
      pointsEarned = 3;
      rewardReason = `åˆ›å»ºé—®å·ã€Š${title}ã€‹`;
    } else if (status === "pending") {
      // æäº¤å®¡æ ¸: è·å¾— 5 ç§¯åˆ†
      pointsEarned = 5;
      rewardReason = `æäº¤é—®å·ã€Š${title}ã€‹å®¡æ ¸`;
    } else if (status === "published" && req.user.role === "admin") {
      // ç®¡ç†å‘˜ç›´æ¥å‘å¸ƒ: è·å¾— 3 ç§¯åˆ†
      pointsEarned = 3;
      rewardReason = `åˆ›å»ºå¹¶å‘å¸ƒé—®å·ã€Š${title}ã€‹`;
    }

    if (pointsEarned > 0) {
      await req.user.increment("points", { by: pointsEarned, transaction: t });
      await PointHistory.create(
        {
          id: `ph_${Date.now()}`,
          userId: req.user.id,
          points: pointsEarned,
          reason: rewardReason,
          type: "earn",
        },
        { transaction: t }
      );
    }

    await t.commit();

    res.status(201).json({
      success: true,
      message: "é—®å·åˆ›å»ºæˆåŠŸ",
      data: {
        ...survey.toJSON(),
        pointsEarned, // è¿”å›è·å¾—çš„ç§¯åˆ†
      },
    });
  } catch (error) {
    await t.rollback();
    next(error);
  }
};
```

### åç«¯ - è·å–ç§¯åˆ†å†å² (userController.js)

```javascript
exports.getPointHistory = async (req, res, next) => {
  try {
    const userId = req.params.id || req.user.id;
    const { page = 1, limit = 20 } = req.query;

    const history = await PointHistory.findAndCountAll({
      where: { userId },
      limit: parseInt(limit),
      offset: (page - 1) * limit,
      order: [["createdAt", "DESC"]], // æŒ‰æ—¶é—´å€’åº
    });

    res.json({
      success: true,
      data: {
        history: history.rows,
        total: history.count,
        page: parseInt(page),
        totalPages: Math.ceil(history.count / limit),
      },
    });
  } catch (error) {
    next(error);
  }
};
```

### å‰ç«¯ - ç­‰çº§è®¡ç®— (AchievementsPage.vue)

```javascript
// ç­‰çº§è®¡ç®—å…¬å¼
const getUserLevel = computed(() => {
  const points = userStats.value.points || 0;
  return Math.floor(points / 500) + 1;
});

// ç­‰çº§æ•°æ®è¡¨
const levelData = [
  { level: 1, points: "0-499", badge: "ğŸ¯" },
  { level: 2, points: "500-999", badge: "ğŸ¥‰" },
  { level: 3, points: "1000-1499", badge: "ğŸ¥ˆ" },
  { level: 4, points: "1500-1999", badge: "ğŸ¥‡" },
  { level: 5, points: "2000-2499", badge: "ğŸ†" },
  { level: 10, points: "4500-4999", badge: "ğŸ‘‘" },
];
```

### å‰ç«¯ - å¾½ç« è¿›åº¦è®¡ç®— (AchievementsPage.vue)

```javascript
// è·å–å½“å‰è¿›åº¦
const getCurrentProgress = (badge) => {
  if (!badge.type) return 0;

  switch (badge.type) {
    case "survey_count":
      return userStats.value.completedSurveys;
    case "login_count":
      return answerStats.value.loginCount;
    case "continuous_login":
      return answerStats.value.continuousLoginDays;
    case "create_count":
      return answerStats.value.createCount;
    case "publish_count":
      return answerStats.value.publishCount;
    case "approved_count":
      return answerStats.value.approvedCount;
    case "favorite_count":
      return answerStats.value.favoriteCount;
    case "comment_count":
      return answerStats.value.commentCount;
    case "share_count":
      return answerStats.value.shareCount;
    case "total_points":
      return userStats.value.points;
    case "profile_complete":
      return answerStats.value.profileComplete;
    default:
      return 0;
  }
};

// å·²è§£é”å¾½ç« 
const unlockedBadges = computed(() => {
  return allBadges.value.filter((badge) =>
    userUnlockedBadgeIds.value.includes(badge.id)
  );
});

// æœªè§£é”å¾½ç« 
const lockedBadges = computed(() => {
  return allBadges.value.filter(
    (badge) => !userUnlockedBadgeIds.value.includes(badge.id)
  );
});
```

### å‰ç«¯ - ç§¯åˆ†æç¤ºå±•ç¤º (AnswerPage.vue)

```javascript
// æäº¤é—®å·åæ˜¾ç¤ºç§¯åˆ†å¥–åŠ±
const submitSurvey = async () => {
  try {
    const result = await submitSurveyApi(surveyId, {
      answers: userAnswers,
      duration: answerDuration,
    });

    // æ›´æ–°ç”¨æˆ·ç§¯åˆ†çŠ¶æ€
    if (result.pointsEarned && result.pointsEarned > 0) {
      const currentProfile = userStore.profile;
      if (currentProfile) {
        currentProfile.points =
          (currentProfile.points || 0) + result.pointsEarned;
        userStore.setProfile(currentProfile);
      }

      // æ˜¾ç¤ºç§¯åˆ†å¥–åŠ±æç¤º
      let message = `é—®å·æäº¤æˆåŠŸï¼è·å¾— ${result.pointsEarned} ç§¯åˆ†`;
      if (result.isFirstSurvey) {
        message += "ï¼ˆé¦–æ¬¡å®Œæˆé¢å¤–å¥–åŠ±20ç§¯åˆ†ï¼‰";
      }
      ElMessage.success(message);
    }

    // è·³è½¬åˆ°ç»“æœé¡µé¢
    router.push({
      name: "SurveyResult",
      params: { id: surveyId },
    });
  } catch (error) {
    ElMessage.error("æäº¤å¤±è´¥ï¼š" + error.message);
  }
};
```
