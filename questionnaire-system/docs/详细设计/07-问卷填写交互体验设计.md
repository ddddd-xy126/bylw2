问卷填写交互体验设计
1、简要描述
（1）功能描述：问卷填写页面提供丰富的交互动画和视觉反馈，提升用户答题体验。主要包含不同题型的交互动画和右侧进度条动画。

（2）代码逻辑：
当用户进入问卷填写页面后，组件在生命周期钩子中加载问卷数据并初始化答题逻辑。页面分为三个区域：左侧统计区域显示答题统计信息，中间题目区域使用 AnimatedQuestion 组件展示当前题目，右侧进度区域使用 ProgressCard 和 RandomProgress 组件展示动态进度动画。AnimatedQuestion 组件根据题目类型（单选、多选、评分、文本）渲染不同的交互动画：单选题选项从左侧逐个滑，鼠标悬停时选项向右移动并放大，点击时触发粒子爆发特效（6 个粒子从选项中心向外扩散）；多选题选项采用交错滑入动，选中时显示勾选图标的弹跳动画和波纹效果；评分题采用星星光晕效果，点击时触发缩放动画。RandomProgress 组件通过对问卷 ID 进行哈希计算，确保同一问卷始终显示同一种进度动画：DynamicProgress 页面实现圆形进度，LiquidFill 页面实现液体填充效果，TreeGrowth 页面实现树木生长动。

时序图描述
用户 → AnswerPage: 访问问卷填写页面（/surveys/answer/:id）
AnswerPage → 后端 API: GET /surveys/:id 获取问卷详情
后端 API → MySQL: 查询 Survey 表（包含 questionList 字段）
MySQL → 后端 API: 返回问卷数据
后端 API → AnswerPage: 返回问卷详情（title、questions、estimatedTime）
AnswerPage → useQuestionnaireLogic: 初始化答题逻辑（initializeLogic）
AnswerPage → AnimatedQuestion: 渲染当前题目和交互动画
AnimatedQuestion → AnimatedQuestion: 应用滑入动画（单选/多选选项延迟滑入）
AnswerPage → RandomProgress: 渲染进度组件并哈希选择动画类型
RandomProgress → DynamicProgress/LiquidFill/TreeGrowth: 渲染对应进度动画

用户 → AnimatedQuestion: 点击选择答案
AnimatedQuestion → AnimatedQuestion: 触发交互动画（粒子爆发/波纹/光晕）
AnimatedQuestion → AnswerPage: 更新答案数据（v-model）
AnswerPage → RandomProgress: 更新进度百分比
RandomProgress → 进度组件: 更新动画进度

用户 → AnswerPage: 点击"下一题"或"提交问卷"
AnswerPage → AnswerPage: 验证必答题（validateRequiredQuestions）
AnswerPage → 后端 API: POST /answers 提交答案数据
后端 API → MySQL: 创建 Answer 记录，更新用户积分
MySQL → 后端 API: 返回提交结果（answerId、pointsEarned）
后端 API → AnswerPage: 返回提交成功
AnswerPage → 用户: 跳转到结果页面或显示下一题

**_时序图描述_**
用户 → 前端界面: 进入问卷填写页面
前端界面 → 后端 API: 获取问卷详情（题目数据）
后端 API → MySQL: 查询问卷和题目列表
MySQL → 后端 API: 返回问卷数据
后端 API → 前端界面: 返回题目信息
前端界面 → 动画组件: 渲染题目交互动画和进度动画
用户 → 前端界面: 选择答案并触发动画效果
前端界面 → 动画组件: 更新进度动画
**_end_**

**_时序图最新描述_**
用户->>前端 AnswerPage.vue: ① 访问问卷填写页面
前端 AnswerPage.vue->>API 层(survey.js): ② 获取问卷详情
API 层(survey.js)->>后端路由(surveys.js): ③ GET /surveys/:id
后端路由(surveys.js)->>控制器(surveyController.js): ④ 查询问卷数据
控制器(surveyController.js)->>数据库: ⑤ 查询 Survey 表
数据库-->>控制器(surveyController.js): ⑥ 返回问卷数据
控制器(surveyController.js)-->>前端 AnswerPage.vue: ⑦ 返回问卷详情
前端 AnswerPage.vue->>动画组件(AnimatedQuestion+RandomProgress): ⑨ 渲染题目和进度动画
用户->>前端 AnswerPage.vue: ⑩ 选择答案
前端 AnswerPage.vue->>动画组件(AnimatedQuestion+RandomProgress): ⑪ 触发交互动画并更新进度
**_end_**

2、接口定义
表 5-7 问卷填写交互体验接口表

接口名称 获取问卷详情接口
接口描述 获取问卷的完整信息，包括题目列表、选项、类型等，用于渲染题目和动画
URL {{baseurl}}/surveys/:id
method GET
请求参数 路径参数: id（问卷 ID）
返回参数 {"id": "1701234567890", "title": "用户体验调查", "questions": [{"id": "q1", "title": "您的年龄段？", "type": "single", "options": [{"id": "opt1", "text": "18-25 岁"}], "required": true}], "estimatedTime": 5}

3、关键代码
代码 5-7 问卷填写交互体验核心代码

// 粒子爆发特效 (AnimatedQuestion.vue)
@keyframes particleBurst {
0% { transform: translate(0, 0) scale(1); opacity: 1; }
100% {
transform: translate(
calc(cos(var(--angle)) _ 40px),
calc(sin(var(--angle)) _ 40px)
) scale(0);
opacity: 0;
}
}

// 随机进度动画选择 (RandomProgress.vue)
const hashString = (str) => {
let h = 5381;
for (let i = 0; i < str.length; i++) {
h = ((h << 5) + h) + str.charCodeAt(i);
}
return Math.abs(h);
};

const selected = computed(() => {
const list = ['dynamic', 'tree', 'liquid'];
const idx = hashString(String(props.questionnaireId)) % list.length;
return list[idx]; // 返回 'dynamic'、'tree' 或 'liquid'
});

// 液体填充动画 (LiquidFill.vue)
const drawWave = () => {
const canvas = canvasRef.value;
const ctx = canvas.getContext('2d');
const { width, height } = canvas;
const waveHeight = height \* (1 - props.percentage / 100);

// 绘制波浪效果
ctx.beginPath();
ctx.moveTo(0, waveHeight);
for (let x = 0; x <= width; x += 5) {
const y = waveHeight + Math.sin((x + offset.value) _ 0.02) _ 10;
ctx.lineTo(x, y);
}
ctx.lineTo(width, height);
ctx.lineTo(0, height);
ctx.closePath();
ctx.fillStyle = 'rgba(64, 158, 255, 0.6)';
ctx.fill();

offset.value += 2; // 波浪移动
requestAnimationFrame(drawWave);
};
