问卷填写交互体验设计
1、简要描述
（1）功能描述：问卷填写页面提供丰富的交互动画和视觉反馈，提升用户答题体验。主要包含不同题型的交互动画和右侧进度条动画。

（2）代码逻辑：
当用户进入问卷填写页面后，组件在生命周期钩子中加载问卷数据并初始化答题逻辑。页面分为三个区域：左侧统计区域显示答题统计信息，中间题目区域使用AnimatedQuestion 组件展示当前题目，右侧进度区域使用ProgressCard和RandomProgress组件展示动态进度动画。AnimatedQuestion 组件根据题目类型（单选、多选、评分、文本）渲染不同的交互动画：单选题选项从左侧逐个滑入（slideInLeft 动画，每个选项延迟0.1s），鼠标悬停时选项向右移动8px并放大1.02倍，点击时触发粒子爆发特效（6个粒子从选项中心向外扩散）；多选题选项采用交错滑入动画（每个选项延迟0.08s），选中时显示勾选图标的弹跳动画和波纹效果；评分题采用星星光晕效果，点击时触发缩放动画。RandomProgress组件通过对问卷ID进行哈希计算，确保同一问卷始终显示同一种进度动画：DynamicProgress实现圆形进度条（SVG 渐变色圆环，带发光滤镜），LiquidFill实现液体填充效果（Canvas 绘制波浪动画和气泡效果），TreeGrowth实现树木生长动画（递归生成树枝，根据进度绘制叶子）。

时序图描述
用户 → AnswerPage: 访问问卷填写页面（/surveys/answer/:id）
AnswerPage → 后端API: GET /surveys/:id 获取问卷详情
后端API → MySQL: 查询Survey表（包含questionList字段）
MySQL → 后端API: 返回问卷数据
后端API → AnswerPage: 返回问卷详情（title、questions、estimatedTime）
AnswerPage → useQuestionnaireLogic: 初始化答题逻辑（initializeLogic）
AnswerPage → AnimatedQuestion: 渲染当前题目和交互动画
AnimatedQuestion → AnimatedQuestion: 应用滑入动画（单选/多选选项延迟滑入）
AnswerPage → RandomProgress: 渲染进度组件并哈希选择动画类型
RandomProgress → DynamicProgress/LiquidFill/TreeGrowth: 渲染对应进度动画

用户 → AnimatedQuestion: 点击选择答案
AnimatedQuestion → AnimatedQuestion: 触发交互动画（粒子爆发/波纹/光晕）
AnimatedQuestion → AnswerPage: 更新答案数据（v-model）
AnswerPage → RandomProgress: 更新进度百分比
RandomProgress → 进度组件: 更新动画进度

用户 → AnswerPage: 点击"下一题"或"提交问卷"
AnswerPage → AnswerPage: 验证必答题（validateRequiredQuestions）
AnswerPage → 后端API: POST /answers 提交答案数据
后端API → MySQL: 创建Answer记录，更新用户积分
MySQL → 后端API: 返回提交结果（answerId、pointsEarned）
后端API → AnswerPage: 返回提交成功
AnswerPage → 用户: 跳转到结果页面或显示下一题

***时序图描述***
用户 → 前端界面: 进入问卷填写页面
前端界面 → 后端API: 获取问卷详情（题目数据）
后端API → MySQL: 查询问卷和题目列表
MySQL → 后端API: 返回问卷数据
后端API → 前端界面: 返回题目信息
前端界面 → 动画组件: 渲染题目交互动画和进度动画
用户 → 前端界面: 选择答案并触发动画效果
前端界面 → 动画组件: 更新进度动画
***end***

2、接口定义
表 5-7 问卷填写交互体验接口表

接口名称 获取问卷详情接口
接口描述 获取问卷的完整信息，包括题目列表、选项、类型等，用于渲染题目和动画
URL {{baseurl}}/surveys/:id
method GET
请求参数 路径参数: id（问卷ID）
返回参数 {"id": "1701234567890", "title": "用户体验调查", "questions": [{"id": "q1", "title": "您的年龄段？", "type": "single", "options": [{"id": "opt1", "text": "18-25岁"}], "required": true}], "estimatedTime": 5}

3、关键代码
代码 5-7 问卷填写交互体验核心代码

// 粒子爆发特效 (AnimatedQuestion.vue)
@keyframes particleBurst {
  0% { transform: translate(0, 0) scale(1); opacity: 1; }
  100% {
    transform: translate(
      calc(cos(var(--angle)) * 40px),
      calc(sin(var(--angle)) * 40px)
    ) scale(0);
    opacity: 0;
  }
}

// 随机进度动画选择 (RandomProgress.vue)
const hashString = (str) => {
  let h = 5381;
  for (let i = 0; i < str.length; i++) {
    h = ((h << 5) + h) + str.charCodeAt(i);
  }
  return Math.abs(h);
};

const selected = computed(() => {
  const list = ['dynamic', 'tree', 'liquid'];
  const idx = hashString(String(props.questionnaireId)) % list.length;
  return list[idx]; // 返回 'dynamic'、'tree' 或 'liquid'
});

// 液体填充动画 (LiquidFill.vue)
const drawWave = () => {
  const canvas = canvasRef.value;
  const ctx = canvas.getContext('2d');
  const { width, height } = canvas;
  const waveHeight = height * (1 - props.percentage / 100);

  // 绘制波浪效果
  ctx.beginPath();
  ctx.moveTo(0, waveHeight);
  for (let x = 0; x <= width; x += 5) {
    const y = waveHeight + Math.sin((x + offset.value) * 0.02) * 10;
    ctx.lineTo(x, y);
  }
  ctx.lineTo(width, height);
  ctx.lineTo(0, height);
  ctx.closePath();
  ctx.fillStyle = 'rgba(64, 158, 255, 0.6)';
  ctx.fill();
  
  offset.value += 2; // 波浪移动
  requestAnimationFrame(drawWave);
};
