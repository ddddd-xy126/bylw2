个性化推荐
1、简要描述
（1）功能描述：个性化推荐功能根据用户的兴趣标签智能推荐相关问卷，帮助用户快速找到感兴趣的内容。系统通过分析用户资料中的标签信息，与问卷的标签进行匹配，计算相关性得分并结合问卷质量和热度进行综合排序。

（2）代码逻辑：
用户在首页选择按"推荐"排序时，系统从 Pinia store 获取当前登录用户的标签信息（userStore.profile.tags）。系统遍历所有问卷，计算每个问卷与用户标签的匹配度：统计问卷标签中有多少个在用户标签列表中，得到匹配数量 matchCount，并判断是否完全匹配。系统根据标签匹配度、问卷评分和参与人数计算综合推荐得分，公式为：推荐得分 = 标签匹配度 × 0.5 + 评分得分 × 0.3 + 热度得分 × 0.2。其中，标签匹配度 = 匹配标签数 / 用户标签总数，评分得分 = 问卷评分 / 5，热度得分 = min(参与人数 / 1000, 1)。系统按照优先级排序：完全匹配的问卷排最前，部分匹配的问卷按匹配数量降序排列，匹配数量相同时按综合得分降序排列。若用户未设置标签，系统随机打乱问卷顺序展示。排序后的问卷列表渲染到页面，用户看到的是与自己兴趣最相关的推荐问卷。

###个性化推荐时序图描述
用户 → 组件: 选择"推荐"排序方式
组件 → useListFilter.js: 触发推荐排序逻辑
useListFilter.js → Pinia store: 获取用户标签
Pinia store → useListFilter.js: 返回用户标签数组
useListFilter.js → useListFilter.js: 遍历问卷计算标签匹配度
useListFilter.js → useListFilter.js: 计算综合推荐得分（标签匹配度×0.5 + 评分得分×0.3 + 热度得分×0.2）
useListFilter.js → useListFilter.js: 按优先级排序（完全匹配 > 匹配数量 > 综合得分）
useListFilter.js → 组件: 返回排序后的问卷列表
组件 → 用户: 渲染推荐问卷列表

2、接口定义
表 5-6 个性化推荐接口表
说明：个性化推荐功能在前端实现，不需要独立的后端接口。推荐算法基于已获取的问卷列表数据（通过 /surveys 接口）和用户标签数据（通过 Pinia store）进行计算。

3、关键代码
代码 5-6 个性化推荐核心实现代码

// 个性化推荐排序逻辑（useListFilter.js）
if (sortBy.value === "recommended") {
  // 获取用户标签
  const userTags = userStore.profile?.tags || [];
  console.log("[推荐系统] 用户标签:", userTags);

  if (userTags && userTags.length > 0) {
    // 有标签时：计算相关性得分
    result.forEach((survey) => {
      const surveyTags = survey.tags || [];

      // 计算标签匹配度
      const matchCount = surveyTags.filter((tag) =>
        userTags.includes(tag)
      ).length;
      const tagScore = matchCount / Math.max(userTags.length, 1);

      // 判断是否完全匹配(用户所有标签都在问卷标签中)
      const isFullMatch = userTags.every((tag) => surveyTags.includes(tag));

      // 综合评分：标签匹配(50%) + 评分(30%) + 参与人数(20%)
      survey.recommendScore =
        tagScore * 0.5 +
        ((survey.rating || 0) / 5) * 0.3 +
        Math.min((survey.participantCount || 0) / 1000, 1) * 0.2;

      // 存储匹配信息用于排序
      survey.matchCount = matchCount;
      survey.isFullMatch = isFullMatch;
    });

    // 按优先级排序：完全匹配 > 部分匹配(按匹配数量) > 无匹配(按评分)
    result.sort((a, b) => {
      // 优先级1: 完全匹配的排最前
      if (a.isFullMatch && !b.isFullMatch) return -1;
      if (!a.isFullMatch && b.isFullMatch) return 1;

      // 优先级2: 匹配标签数量多的在前
      if (a.matchCount !== b.matchCount) {
        return b.matchCount - a.matchCount;
      }

      // 优先级3: 匹配数量相同时,按综合得分排序
      return (b.recommendScore || 0) - (a.recommendScore || 0);
    });

    console.log(
      "[推荐系统] 基于标签匹配推荐，前5个问卷:",
      result.slice(0, 5).map((s) => ({
        title: s.title,
        matchCount: s.matchCount,
        isFullMatch: s.isFullMatch,
        score: s.recommendScore,
      }))
    );
  } else {
    // 无标签时：随机打乱顺序展示
    result = result.sort(() => Math.random() - 0.5);
    console.log("[推荐系统] 用户无标签，随机推荐");
  }
}
