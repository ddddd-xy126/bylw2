个人数据统计
1、简要描述
（1）功能描述：个人数据统计功能展示用户在平台的活跃情况和数据概览，包括创建问卷数、参与问卷数、获得积分和收藏问卷四项核心指标。

（2）代码逻辑：
用户进入个人中心的个人信息页面后，组件在 onMounted 生命周期钩子中自动调用 loadUserStats 函数加载统计数据。系统首先从 Pinia store（全局状态管理）中获取当前登录用户的基本信息 profile 对象，并进行用户登录状态验证，若 profile 为空则输出警告并终止加载流程，确保数据获取的安全性。验证通过后，系统提取用户 ID 作为后续 API 请求的关键参数。

在数据获取阶段，系统采用多数据源协同的策略：首先从本地 Pinia store 的 user.profile.points 字段直接读取当前积分数，避免不必要的网络请求，提升响应速度；同时从 userStore.favorites 数组获取收藏列表长度，统计得到收藏问卷数。这两项数据均来自于客户端已缓存的状态，实现即时展示。

对于需要实时查询的数据，系统通过后端 API 发起异步请求：调用 GET /surveys 接口并携带 userId 参数和 limit=5000 限制，查询该用户创建的所有问卷列表，通过返回数组的长度统计创建问卷数；同时调用 GET /answers 接口并携带 userId 参数，查询该用户提交的所有答案记录，统计参与问卷数。这些 API 请求均通过 apiClient 统一封装，自动处理认证令牌的携带和响应拦截。

后端接收到请求后，路由层将参数传递给对应的 Controller 层，Controller 调用 Model 层的 Sequelize ORM 方法查询 MySQL 数据库中的 surveys 表和 answers 表，根据 userId 进行数据过滤，并将结果返回给前端。前端接收到响应数据后，通过数组长度计算或直接读取数值的方式，将四项统计指标（创建问卷数、参与问卷数、获得积分、收藏问卷）更新到 userStats 响应式对象的对应字段中。

由于 userStats 是基于 Vue 3 的 ref 或 reactive 定义的响应式数据，当其值发生变化时，Vue 的响应式系统会自动触发视图更新，前端界面上的统计卡片组件会实时渲染最新的数据。整个数据流从 Pinia store 和后端 API 汇聚到 userStats 对象，再通过 Vue 模板的数据绑定机制展示到用户界面，形成完整的数据加载-更新-渲染闭环。异常情况下，系统通过 try-catch 捕获请求失败等错误，输出详细的错误日志便于调试，同时保证页面不会因局部数据加载失败而崩溃。

###个人数据统计时序图描述
用户 → InfoPage.vue: 访问个人信息页面
InfoPage.vue → loadUserStats: 加载用户统计数据
loadUserStats → Pinia store: 获取用户基本信息
Pinia store → loadUserStats: 返回用户信息和积分
loadUserStats → 后端 API: 并发请求用户问卷和答案数据
后端 API → MySQL: 查询用户相关数据
MySQL → 后端 API: 返回数据
后端 API → loadUserStats: 返回问卷和答案数据
loadUserStats → loadUserStats: 统计创建/参与问卷数
loadUserStats → Pinia store: 获取收藏数量
loadUserStats → loadUserStats: 组装统计对象
InfoPage.vue → 界面: 渲染统计卡片

2、接口定义
表 5-4 个人数据统计接口表
接口名称 查询用户问卷接口
接口描述 查询指定用户创建的问卷列表，用于统计创建问卷数
URL {{baseurl}}/surveys?userId={id}&limit=5000
method GET
请求参数 userId: 用户 ID, limit: 查询数量限制
返回参数 [{"id": "1", "title": "问卷 1", "userId": "123", ...}, ...]

接口名称 查询用户答题结果接口
接口描述 查询指定用户提交的答案记录列表，用于统计参与问卷数
URL {{baseurl}}/answers?userId={id}
method GET
请求参数 userId: 用户 ID
返回参数 [{"id": "1", "surveyId": "1", "userId": "123", "answers": [...], ...}, ...]

3、关键代码
代码 5-4 个人数据统计核心实现代码

// 加载用户统计数据（InfoPage.vue）
const loadUserStats = async () => {
try {
// 从用户 store 获取基本信息
const profile = userStore.profile;
if (!profile) {
console.warn("用户未登录");
return;
}

    // 获取积分（直接从 profile 中读取）
    userStats.totalPoints = profile.points || 0;

    // 获取收藏数量（从 store 的 favorites 数组）
    userStats.totalCollections = userStore.favorites?.length || 0;

    // 使用后端 API 获取该用户创建的问卷数量
    const userSurveys = await apiClient.get(
      `/surveys?userId=${profile.id}&limit=5000`
    );
    userStats.totalQuestionnaires = userSurveys?.length || 0;

    // 使用后端 API 获取该用户的答题数量（参与问卷）
    const userAnswers = await apiClient.get(`/answers?userId=${profile.id}`);
    userStats.totalAnswers = userAnswers?.length || 0;

    console.log("用户统计已加载:", userStats);

} catch (error) {
console.error("加载用户统计失败:", error);
}
};

// 生命周期钩子：页面加载时自动获取统计数据
onMounted(() => {
loadUserInfo(); // 加载用户基本信息
loadUserStats(); // 加载用户统计数据
loadTagOptions(); // 加载标签选项
});

**_时序图最新描述_**
用户->>前端 InfoPage.vue: ① 访问个人信息页面
前端 InfoPage.vue->>前端 InfoPage.vue: ② 调用加载函数
前端 InfoPage.vue->>Pinia(userStore): ③ 获取用户基本信息
Pinia(userStore)-->>前端 InfoPage.vue: ④ 返回用户信息
前端 InfoPage.vue->>API 层(apiClient): ⑤ 并发请求问卷和答题数据
API 层(apiClient)->>后端路由(surveys.js + answers.js): ⑥ 请求接口
后端路由(surveys.js + answers.js)->>数据库: ⑦ 查询用户问卷和答题记录
数据库-->>后端路由(surveys.js + answers.js): ⑧ 返回查询结果
后端路由(surveys.js + answers.js)-->>前端 InfoPage.vue: ⑨ 返回问卷和答题数据
前端 InfoPage.vue->>前端 InfoPage.vue: ⑩ 统计数量并更新 userStats
前端 InfoPage.vue-->>用户: ⑪ 渲染统计卡片
**_end_**
