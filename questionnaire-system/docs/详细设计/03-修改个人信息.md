修改个人信息
1、简要描述
（1）功能描述：用户可以在个人中心修改个人基本信息、头像和修改，包含用户名、邮箱、手机号、性别、年龄、城市、职业、个人简介和兴趣标签等基本信息。

（2）代码逻辑：
用户进入个人中心的个人信息页面，系统从Pinia store加载当前用户的基本信息并渲染到表单中。用户在个人中心页面，修改表单中的各项信息或者头像、密码后点击保存。前端对表单数据进行验证，验证通过后将更新数据通过 HTTP 请求发送到后端。后端接收请求后，验证用户登录状态，更新数据库中的用户记录，并检查资料完整度。若用户之前资料不完整，此次更新后达到 100% 完整度（所有必填字段均有值），系统自动为用户增加 15 积分，并记录积分历史。后端返回更新成功的响应，前端更新 Pinia store 中的用户信息，退出编辑模式，并显示成功提示（若获得积分则提示积分奖励信息）。

###修改个人信息时序图描述
用户 → InfoPage.vue: 执行修改操作
InfoPage.vue → 后端API: 调用updateProfileApi更新用户资料
后端API → MySQL: 验证并更新用户信息
MySQL → 后端API: 返回更新结果
后端API → 后端API: 检查资料完整度，发放积分（若满足条件）
后端API → InfoPage.vue: 返回更新成功响应
InfoPage.vue → Pinia store: 更新本地用户数据
InfoPage.vue → 用户: 显示成功提示，结束编辑

2、接口定义
表 5-3 修改个人信息接口表
接口名称       更新用户资料接口
接口描述       用户更新个人信息时调用接口，支持修改基本信息、头像、密码
URL           {{baseurl}}/users/:id
method        PUT
请求参数       {"username": "newname", "email": "new@example.com", "phone": "13800138000", "gender": "male", "age": 25, "city": "北京", "profession": "工程师", "bio": "个人简介", "tags": ["技术", "旅行"], "avatar": "https://...", "password": "newpassword123"}
返回参数        {"success": true, "message": "资料更新成功", "data": {"id": "123", "username": "newname", "email": "new@example.com", ...}}

3、关键代码
代码 5-3 修改个人信息核心实现代码
// 更新用户资料（userController.js）
exports.updateUser = async (req, res, next) => {
  try {
    const userId = req.params.id;
    const updates = req.body;

    // 不允许修改敏感字段
    delete updates.id;
    delete updates.role;

    const user = await User.findByPk(userId);
    if (!user) {
      return res.status(404).json({
        success: false,
        message: "用户不存在",
      });
    }

    // 如果更新密码，会触发 User Model 的 beforeUpdate hook 自动加密
    await user.update(updates);

    res.json({
      success: true,
      data: user.toSafeObject(),
    });
  } catch (error) {
    next(error);
  }
};
