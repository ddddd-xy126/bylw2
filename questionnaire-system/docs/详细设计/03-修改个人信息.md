修改个人信息
1、简要描述
（1）功能描述：用户可以在个人中心修改个人基本信息、头像和修改，包含用户名、邮箱、手机号、性别、年龄、城市、职业、个人简介和兴趣标签等基本信息。

（2）代码逻辑：
用户在个人中心页面，修改表单中的各项信息或者头像、密码后点击保存。前端对表单数据进行验证，验证通过后将更新数据通过HTTP请求发送到后端。后端接收请求后，验证用户登录状态，更新数据库中的用户记录。后端返回更新成功的响应，前端更新本地的用户信息，退出编辑模式，并显示成功提示。


***时序图最新描述***
    用户->>前端InfoPage.vue: 填写表单，点击保存
    前端InfoPage.vue->>前端InfoPage.vue:  校验表单数据
    前端InfoPage.vue->>API层(user.js):  调用修改个人信息接口
    API层(user.js)->>后端路由(users.js): 请求修改信息接口
    后端路由(users.js)->>认证中间件(auth.js): 验证Token有效性
    认证中间件(auth.js)->>控制器(userController.js): 处理请求
    控制器(userController.js)->>数据库:  更新用户记录
    数据库-->>控制器(userController.js): 返回更新结果
    控制器(userController.js)-->>前端InfoPage.vue: 返回成功响应
    前端InfoPage.vue->>InfoPage.vue: 更新本地用户数据
    前端InfoPage.vue-->>用户: 显示成功提示
***end***

2、接口定义
表 5-3 修改个人信息接口表
接口名称       更新用户资料接口
接口描述       用户更新个人信息时调用接口，支持修改基本信息、头像、密码
URL           {{baseurl}}/users/:id
method        PUT
请求参数       {"username": "newname", "email": "new@example.com", "phone": "13800138000", "gender": "male", "age": 25, "city": "北京", "profession": "工程师", "bio": "个人简介", "tags": ["技术", "旅行"], "avatar": "https://...", "password": "newpassword123"}
返回参数        {"success": true, "message": "资料更新成功", "data": {"id": "123", "username": "newname", "email": "new@example.com", ...}}

3、关键代码
代码 5-3 修改个人信息核心实现代码
// 更新用户资料（userController.js）
exports.updateUser = async (req, res, next) => {
  try {
    const userId = req.params.id;
    const updates = req.body;

    // 不允许修改敏感字段
    delete updates.id;
    delete updates.role;

    const user = await User.findByPk(userId);
    if (!user) {
      return res.status(404).json({
        success: false,
        message: "用户不存在",
      });
    }

    // 如果更新密码，会触发 User Model 的 beforeUpdate hook 自动加密
    await user.update(updates);

    res.json({
      success: true,
      data: user.toSafeObject(),
    });
  } catch (error) {
    next(error);
  }
};
