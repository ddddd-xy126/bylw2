问卷浏览与搜索
1、简要描述
（1）功能描述:用户可以在问卷列表页面浏览所有已发布的问卷，并通过搜索框和分类按钮进行筛选。

（2）代码逻辑:
用户进入问卷列表页面，组件在生命周期钩子中加载问卷列表和分类数据。系统通过调用 listSurveys 接口一次性获取所有问卷数据（limit=5000），通过 getCategoriesApi 接口获取所有分类信息，将数据存储到 Pinia store 中。搜索、分类筛选、排序等功能均在前端实现，无需额外请求后端。页面渲染时，从 store 读取问卷列表，通过计算属性过滤出状态为 published 且 isCollecting 不为 false 的问卷。用户在搜索框中输入关键词时，前端通过 JavaScript 实时过滤问卷标题和描述中包含该关键词的问卷（不区分大小写）。用户点击分类按钮时，前端根据选中分类的 categoryId 过滤问卷列表。前端还支持三种排序方式：最新(latest)、热门(hot)和推荐(recommended)，分页也在前端通过数组切片实现。

###问卷浏览与搜索时序图描述
用户 → List.vue: 进入问卷列表页面（/surveys 路由）
List.vue → loadData: onMounted 钩子调用 loadData 函数
loadData → 后端 API: 并发请求所有问卷（GET /surveys?limit=5000）和分类列表（GET /categories）
后端 API → MySQL: 查询 surveys 表（无状态筛选，返回所有问卷）
MySQL → 后端 API: 返回所有问卷数据（最多 5000 条）
后端 API → MySQL: 查询 categories 表
MySQL → 后端 API: 返回所有分类数据
后端 API → loadData: 返回问卷和分类数据
loadData → Pinia store: 存储所有问卷和分类数据
List.vue → Pinia store: 读取问卷和分类数据
List.vue → computed 计算属性: 前端过滤（status=published 且 isCollecting≠false）
computed 计算属性 → 用户界面: 渲染过滤后的问卷列表

用户 → List.vue: 输入搜索关键词或点击分类按钮
List.vue → computed 计算属性: 前端实时过滤（关键词匹配标题/描述，或按 categoryId 筛选）
computed 计算属性 → 前端分页逻辑: 数组切片分页
前端分页逻辑 → 用户界面: 更新展示的问卷列表（无需请求后端）

2、接口定义
表 5-5 问卷浏览与搜索接口表
接口名称 获取问卷列表接口
接口描述 一次性获取所有问卷数据，前端自行进行搜索、分类筛选、排序和分页
URL {{baseurl}}/surveys
method GET
请求参数 limit: 每页数量（前端固定传 5000 以获取所有数据）
返回参数 [{"id": "1", "title": "问卷标题", "description": "问卷描述", "categoryId": "1", "status": "published", "participantCount": 100, "averageRating": 4.5, "isCollecting": true, ...}, ...]
备注 虽然后端接口支持 status、categoryId、search、page 等参数，但前端为了实现快速筛选和排序，选择一次性获取所有数据在客户端处理

接口名称 获取分类列表接口
接口描述 获取所有问卷分类，用于分类筛选按钮展示
URL {{baseurl}}/categories
method GET
请求参数 无
返回参数 [{"id": "1", "name": "教育培训", "slug": "education", "count": 15, ...}, ...]

3、关键代码
代码 5-5 问卷浏览与搜索核心实现代码

// 前端 API 调用 - 一次性获取所有问卷（survey.js）
export async function listSurveys() {
// 设置较大的 limit 以获取所有问卷,前端自行分页
const surveys = await apiClient.get("/surveys?limit=5000");
return surveys;
}

// 加载问卷和分类数据（useHomeLogic.js）
const loadData = async () => {
loading.value = true;
try {
// 并发请求问卷列表和分类列表
const [surveysData, categoriesData] = await Promise.all([
listSurveys(),
getCategoriesApi(),
]);
// 存储到 Pinia store
dataStore.setSurveys(surveysData || []);
dataStore.setCategories(categoriesData || []);
} catch (error) {
console.error("加载数据失败:", error);
ElMessage.error("加载数据失败");
} finally {
loading.value = false;
}
};

// 前端搜索和分类过滤逻辑（useHomeLogic.js）
const filteredSurveys = computed(() => {
const surveysArray = Array.isArray(surveys.value) ? surveys.value : [];
let filtered = surveysArray.filter(
(survey) => survey.status === "published" && survey.isCollecting !== false
);

// 前端搜索过滤
if (searchQuery.value.trim()) {
const query = searchQuery.value.toLowerCase();
filtered = filtered.filter(
(survey) =>
survey.title.toLowerCase().includes(query) ||
survey.description.toLowerCase().includes(query)
);
}

// 前端分类过滤
if (selectedCategory.value) {
filtered = filtered.filter(
(survey) => survey.categoryId === selectedCategory.value
);
}

// 前端排序
switch (sortBy.value) {
case "latest":
filtered.sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt));
break;
case "hot":
filtered.sort((a, b) => (b.participantCount || 0) - (a.participantCount || 0));
break;
case "recommended":
// 智能推荐逻辑（基于用户标签匹配）
// ...省略详细推荐算法代码
break;
}

// 前端分页
const start = (currentPage.value - 1) \* pageSize.value;
const end = start + pageSize.value;
return filtered.slice(start, end);
});

// 选择分类（List.vue）
const selectCategory = (catId) => {
selectedCategory.value = catId;
currentPage.value = 1; // 重置页码
// 无需调用后端接口，计算属性自动重新计算
};

**_时序图最新描述_**
用户->>前端 List.vue: ① 访问问卷列表页
前端 List.vue->>前端 List.vue: ② onMounted 调用 loadData
前端 List.vue->>API 层(survey.js): ③ 请求所有问卷（limit=5000）
API 层(survey.js)->>控制器(surveyController): ④ GET /surveys?limit=5000
控制器(surveyController)->>数据库: ⑤ 查询 surveys 表（无筛选条件）
数据库-->>控制器(surveyController): ⑥ 返回所有问卷数据
前端 List.vue->>API 层(category.js): ⑦ 并发请求分类列表
API 层(category.js)->>控制器(categoryController): ⑧ GET /categories
控制器(categoryController)->>数据库: ⑨ 查询 categories 表
数据库-->>控制器(categoryController): ⑩ 返回分类数据
控制器(surveyController + categoryController)-->>前端 List.vue: ⑪ 返回问卷+分类
前端 List.vue->>Pinia Store: ⑫ 存储所有数据至 Pinia
前端 List.vue->>computed 计算属性: ⑬ 前端过滤 published 且 isCollecting 的问卷
computed 计算属性-->>用户: ⑭ 渲染问卷列表
用户->>前端 List.vue: ⑮ 输入搜索或选择分类
前端 List.vue->>computed 计算属性: ⑯ 前端实时过滤（无需请求后端）
computed 计算属性-->>用户: ⑰ 立即更新显示结果
