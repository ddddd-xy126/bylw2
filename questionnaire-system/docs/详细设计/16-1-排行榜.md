用户积分排行榜
1、简要描述
（1）功能描述：用户积分排行榜展示系统中积分最高的活跃用户，帮助用户了解平台的优秀贡献者。

（2）代码逻辑：用户访问积分排行榜页面时，前端调用 user.js 中的接口向后端发送 GET /users 请求并携带排序参数 \_sort=points&\_order=desc，后端路由从数据库查询用户数据并按积分字段降序排列后返回给前端，前端接收数据后进行二次排序确保准确性并过滤掉管理员用户，将前三名用户以颁奖台形式展示，4-20 名以列表形式展示。

**_时序图最新描述_**
用户->>前端积分排行榜页面 UserPointsPage.vue: ① 访问积分排行榜页面
前端积分排行榜页面 UserPointsPage.vue->>API 层(user.js): ② 调用用户查询接口
API 层(user.js)->>后端路由(users.js): ③ GET /users?_sort=points&\_order=desc&\_limit=20
后端路由(users.js)->>控制器(userController.js): ④ 查询用户数据
控制器(userController.js)->>数据库: ⑤ 查询 User 表并按积分降序排列
数据库-->>控制器(userController.js): ⑥ 返回用户列表
控制器(userController.js)-->>前端积分排行榜页面 UserPointsPage.vue: ⑦ 返回用户数据
前端积分排行榜页面 UserPointsPage.vue->>前端积分排行榜页面 UserPointsPage.vue: ⑧ 过滤管理员并二次排序
前端积分排行榜页面 UserPointsPage.vue->>用户: ⑨ 展示前三名颁奖台和 4-20 名列表


2、接口定义
表 5-16-1 用户积分排行榜接口表

接口名称 获取用户积分排行榜接口
接口描述 查询积分最高的用户，包含用户基本信息与积分/等级统计
URL {{baseurl}}/users?\_sort=points&\_order=desc&\_limit=20
method GET
请求参数 无
返回参数 {"success": true, "data": [{"id": "user_789", "nickname": "积分达人", "avatar": "https://...", "points": 3580, "level": 5, "bio": "热爱分享", "profession": "产品经理", "city": "北京"}]}

3、关键代码
代码 5-16-1 用户积分排行榜核心代码

// 加载积分排行榜数据 (UserPointsPage.vue)
const loadRankings = async () => {
loading.value = true;
try {
// 获取所有用户，按积分降序排列
const users = await apiClient.get('/users', {
params: {
\_sort: 'points',
\_order: 'desc',
\_limit: 20
}
});

    // 客户端二次排序确保正确（从大到小）
    const sortedUsers = users.sort((a, b) => b.points - a.points);

    // 过滤掉管理员用户
    rankings.value = sortedUsers.filter(user => user.role !== 'admin');

} catch (error) {
ElMessage.error('加载排行榜失败');
} finally {
loading.value = false;
}
};

// 前三名和其余名次分离
const topThree = computed(() => rankings.value.slice(0, 3));
const otherRankings = computed(() => rankings.value.slice(3, 20));

// 获取等级标签类型
const getLevelTagType = (level) => {
if (level >= 5) return 'danger';
if (level >= 3) return 'warning';
return 'success';
};
