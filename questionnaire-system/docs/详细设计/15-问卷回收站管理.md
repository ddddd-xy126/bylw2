问卷回收站管理
1、简要描述
（1）功能描述：回收站模块用于统一管理用户删除的问卷。系统采用“先入回收站，再决定恢复或永久删除”的机制，确保用户误删可逆，提高数据安全性。

（2）代码逻辑：当用户在回收站页面点击“恢复”时，前端根据回收站中保存的原始surveyData调用survey.js的创建接口发送POST /surveys请求，以重新创建一份新的问卷记录；数据库插入成功后由后端将新建问卷返回给前端，随后前端调用recycleBin.js的删除接口发送DELETE /recycleBin/:id请求用于移除对应的回收站记录，在数据库删除成功后前端向用户显示“问卷恢复成功”。若用户选择“永久删除”，永久删除的代码逻辑在“恢复”操作的后半程是一样的，最后像前端显示的是“问卷已永久删除”。

***时序图最新描述***
 
    用户->>前端回收站页面TrashPage.vue: ⑧ 点击"恢复"按钮
    前端回收站页面TrashPage.vue->>API层(survey.js): ⑨ 调用创建问卷接口
    API层(survey.js)->>后端路由(surveys.js): ⑩ POST /surveys (使用surveyData恢复)
    后端路由(surveys.js)->>数据库: ⑪ 创建新问卷记录
    数据库-->>后端路由(surveys.js): ⑫ 返回新问卷

    前端回收站页面TrashPage.vue->>API层(recycleBin.js): ⑬ 调用删除回收站记录接口
    API层(recycleBin.js)->>后端路由(recycleBin.js): ⑭ DELETE /recycleBin/:id
    后端路由(recycleBin.js)->>数据库: ⑮ 删除RecycleBin记录
    数据库-->>前端回收站页面TrashPage.vue: ⑯ 返回操作结果
    前端回收站页面TrashPage.vue->>用户: ⑰ 显示"问卷恢复成功"提示


***end***


2、接口定义
表 5-15 问卷回收站管理接口表

接口名称 获取回收站列表接口
接口描述 查询回收站列表，非管理员仅查看自己的回收站项
URL {{baseurl}}/recycleBin?userId={userId}
method GET
请求参数 {"userId": "user_123"} (可选，管理员可用)
返回参数 {"success": true, "data": [{"id": "rb_1701234567890", "surveyId": "survey_123", "title": "用户体验调查", "originalStatus": "published", "deletedAt": "2024-01-15T10:30:00.000Z", "surveyData": {...}}, ...]}

接口名称 永久删除问卷接口
接口描述 从回收站永久删除问卷，数据无法恢复
URL {{baseurl}}/recycleBin/:id
method DELETE
请求参数 路径参数: id（回收站记录ID）
返回参数 {"success": true, "message": "永久删除成功"}

3、关键代码
代码 5-15 问卷回收站管理核心代码

// 永久删除问卷 (recycleBin.js)
router.delete("/:id", authenticate, async (req, res) => {
  const item = await RecycleBin.findByPk(req.params.id);
  
  if (!item) {
    return res.status(404).json({ success: false, message: "记录不存在" });
  }
  
  // 验证权限：管理员或所有者
  if (req.user.role !== "admin" && item.userId !== req.user.id) {
    return res.status(403).json({ success: false, message: "无权限操作" });
  }
  
  await item.destroy();
  res.json({ success: true, message: "永久删除成功" });
});

// 前端恢复问卷操作 (TrashPage.vue)
const handleRestore = async (item) => {
  try {
    // 使用原始数据重新创建问卷
    await createSurveyApi({ 
      ...item.surveyData, 
      status: item.originalStatus 
    });
    
    // 删除回收站记录
    await deleteFromRecycleBinApi(item.id);
    
    ElMessage.success('问卷恢复成功');
    await loadRecycleBin(); // 刷新列表
  } catch (error) {
    ElMessage.error('恢复失败');
  }
};