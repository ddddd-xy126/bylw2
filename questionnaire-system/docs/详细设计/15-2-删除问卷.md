删除问卷
1、简要描述
（1）功能描述：删除问卷功能允许用户在问卷管理页面将不需要的问卷移入回收站。

（2）代码逻辑：用户在问卷管理页面中，当用户点击“删除问卷”按钮时，前端会调用 survey.js 中的删除接口向后端发送 DELETE /surveys/:id 请求，后端路由将请求交由控制器处理，控制器首先为该问卷创建一条 RecycleBin 回收站记录并对 Survey 执行软删除，数据库完成写入后将结果返回给控制器并最终回传至前端，前端随后向用户提示“问卷已移至回收站”。

**_时序图最新描述_**
用户->>前端问卷管理页面: ① 点击"删除问卷"按钮
前端问卷管理页面->>API 层(survey.js): ② 调用删除问卷接口
API 层(survey.js)->>后端路由(surveys.js): ③ DELETE /surveys/:id
后端路由(surveys.js)->>控制器(surveyController.js): ④ 调用 deleteSurvey 方法
控制器(surveyController.js)->>数据库: ⑤ 创建 RecycleBin 记录并软删除 Survey
数据库-->>控制器(surveyController.js): ⑥ 返回操作结果
控制器(surveyController.js)-->>前端问卷管理页面: ⑦ 返回成功消息
前端问卷管理页面->>用户: ⑧ 显示"问卷已移至回收站"提示
**_end_**

2、接口定义
表 5-15-2 删除问卷接口表

接口名称 删除问卷接口（移入回收站）
接口描述 软删除问卷，将问卷移至回收站，保留 30 天后自动清理
URL {{baseurl}}/surveys/:id
method DELETE
请求参数 路径参数: id（问卷 ID）
返回参数 {"success": true, "message": "问卷已移至回收站"}

3、关键代码
代码 5-15-2 删除问卷核心代码

// 软删除问卷：写入回收站，删除原问卷 (surveyController.js)
exports.deleteSurvey = async (req, res) => {
const t = await sequelize.transaction();
try {
const survey = await Survey.findByPk(req.params.id);

    if (!survey) {
      await t.rollback();
      return res.status(404).json({ success: false, message: "问卷不存在" });
    }

    // 创建回收站记录
    await RecycleBin.create({
      id: `rb_${Date.now()}`,
      surveyId: survey.id,
      title: survey.title,
      originalStatus: survey.status,
      surveyData: survey.toJSON(),
      userId: survey.userId,
      deletedAt: new Date(),
    }, { transaction: t });

    // 软删除原问卷
    await survey.destroy({ transaction: t });

    await t.commit();
    res.json({ success: true, message: "问卷已移至回收站" });

} catch (e) {
await t.rollback();
res.status(500).json({ success: false, message: "删除失败" });
}
};