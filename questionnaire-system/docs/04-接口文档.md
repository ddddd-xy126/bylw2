# é—®å·ç³»ç»Ÿ - API æ¥å£æ–‡æ¡£

## ğŸ“‹ æ¦‚è¿°

æœ¬æ–‡æ¡£æè¿°é—®å·ç³»ç»Ÿåç«¯ API çš„æ‰€æœ‰æ¥å£ï¼ŒåŒ…æ‹¬è¯·æ±‚æ–¹å¼ã€å‚æ•°ã€å“åº”æ ¼å¼ç­‰ã€‚

### åŸºç¡€ä¿¡æ¯
- **Base URL**: `http://localhost:3000/api`
- **æ•°æ®æ ¼å¼**: JSON
- **è®¤è¯æ–¹å¼**: JWT Bearer Token
- **å­—ç¬¦ç¼–ç **: UTF-8

### é€šç”¨å“åº”æ ¼å¼

#### æˆåŠŸå“åº”
```json
{
  "success": true,
  "data": { ... },
  "message": "æ“ä½œæˆåŠŸ"
}
```

#### é”™è¯¯å“åº”
```json
{
  "success": false,
  "message": "é”™è¯¯ä¿¡æ¯",
  "errors": [ ... ]
}
```

### HTTP çŠ¶æ€ç 
- `200` - æˆåŠŸ
- `201` - åˆ›å»ºæˆåŠŸ
- `400` - è¯·æ±‚å‚æ•°é”™è¯¯
- `401` - æœªè®¤è¯
- `403` - æ— æƒé™
- `404` - èµ„æºä¸å­˜åœ¨
- `500` - æœåŠ¡å™¨é”™è¯¯

---

## ğŸ” è®¤è¯æ¥å£ (`/api/auth`)

### 1. ç”¨æˆ·æ³¨å†Œ

**POST** `/auth/register`

**è¯·æ±‚å¤´**
```
Content-Type: application/json
```

**è¯·æ±‚ä½“**
```json
{
  "username": "testuser",
  "password": "password123",
  "email": "test@example.com",
  "nickname": "æµ‹è¯•ç”¨æˆ·"
}
```

**å‚æ•°è¯´æ˜**
| å‚æ•° | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|------|------|------|------|
| username | string | âœ… | ç”¨æˆ·åï¼Œ3-20å­—ç¬¦ï¼Œå­—æ¯æ•°å­—ä¸‹åˆ’çº¿ |
| password | string | âœ… | å¯†ç ï¼Œè‡³å°‘6å­—ç¬¦ |
| email | string | âŒ | é‚®ç®± |
| nickname | string | âŒ | æ˜µç§°ï¼Œé»˜è®¤ä¸ºç”¨æˆ·å |

**å“åº”**
```json
{
  "success": true,
  "data": {
    "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
    "user": {
      "id": "user_123456",
      "username": "testuser",
      "nickname": "æµ‹è¯•ç”¨æˆ·",
      "email": "test@example.com",
      "role": "user",
      "points": 100,
      "avatar": null
    }
  }
}
```

---

### 2. ç”¨æˆ·ç™»å½•

**POST** `/auth/login`

**è¯·æ±‚ä½“**
```json
{
  "username": "testuser",
  "password": "password123"
}
```

**å‚æ•°è¯´æ˜**
| å‚æ•° | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|------|------|------|------|
| username | string | âœ… | ç”¨æˆ·å |
| password | string | âœ… | å¯†ç  |

**å“åº”**
```json
{
  "success": true,
  "data": {
    "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
    "user": {
      "id": "user_123456",
      "username": "testuser",
      "nickname": "æµ‹è¯•ç”¨æˆ·",
      "role": "user",
      "points": 150,
      "level": 1
    }
  }
}
```

---

### 3. è·å–å½“å‰ç”¨æˆ·ä¿¡æ¯

**GET** `/auth/me`

**è¯·æ±‚å¤´**
```
Authorization: Bearer {token}
```

**å“åº”**
```json
{
  "success": true,
  "data": {
    "id": "user_123456",
    "username": "testuser",
    "nickname": "æµ‹è¯•ç”¨æˆ·",
    "email": "test@example.com",
    "role": "user",
    "points": 150,
    "level": 1,
    "avatar": "https://...",
    "createdAt": "2024-01-01T00:00:00.000Z"
  }
}
```

---

### 4. ç™»å‡º

**POST** `/auth/logout`

**è¯·æ±‚å¤´**
```
Authorization: Bearer {token}
```

**å“åº”**
```json
{
  "success": true,
  "message": "ç™»å‡ºæˆåŠŸ"
}
```

---

### 5. åˆ·æ–° Token

**POST** `/auth/refresh`

**è¯·æ±‚å¤´**
```
Authorization: Bearer {old_token}
```

**å“åº”**
```json
{
  "success": true,
  "data": {
    "token": "new_token_here"
  }
}
```

---

## ğŸ‘¤ ç”¨æˆ·æ¥å£ (`/api/users`)

### 1. è·å–ç”¨æˆ·åˆ—è¡¨

**GET** `/users`

**Query å‚æ•°**
| å‚æ•° | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|------|------|------|------|
| page | number | âŒ | é¡µç ï¼Œé»˜è®¤1 |
| limit | number | âŒ | æ¯é¡µæ•°é‡ï¼Œé»˜è®¤10 |
| sort | string | âŒ | æ’åºå­—æ®µï¼Œé»˜è®¤ createdAt |
| order | string | âŒ | æ’åºæ–¹å¼ï¼Œasc/descï¼Œé»˜è®¤ desc |

**å“åº”**
```json
{
  "success": true,
  "data": {
    "users": [
      {
        "id": "user_123",
        "username": "user1",
        "nickname": "ç”¨æˆ·1",
        "avatar": "https://...",
        "points": 200,
        "level": 2,
        "role": "user"
      }
    ],
    "total": 100,
    "page": 1,
    "totalPages": 10
  }
}
```

---

### 2. è·å–å•ä¸ªç”¨æˆ·ä¿¡æ¯

**GET** `/users/:id`

**å“åº”**
```json
{
  "success": true,
  "data": {
    "id": "user_123",
    "username": "testuser",
    "nickname": "æµ‹è¯•ç”¨æˆ·",
    "avatar": "https://...",
    "bio": "ä¸ªäººç®€ä»‹",
    "points": 200,
    "level": 2,
    "gender": "male",
    "age": 25,
    "city": "åŒ—äº¬",
    "profession": "å·¥ç¨‹å¸ˆ",
    "tags": ["æŠ€æœ¯", "é˜…è¯»"],
    "createdAt": "2024-01-01T00:00:00.000Z"
  }
}
```

---

### 3. æ›´æ–°ç”¨æˆ·ä¿¡æ¯

**PATCH** `/users/:id`

**è¯·æ±‚å¤´**
```
Authorization: Bearer {token}
```

**è¯·æ±‚ä½“**
```json
{
  "nickname": "æ–°æ˜µç§°",
  "bio": "æ–°çš„ä¸ªäººç®€ä»‹",
  "avatar": "https://new-avatar.jpg",
  "gender": "female",
  "age": 26,
  "city": "ä¸Šæµ·",
  "profession": "è®¾è®¡å¸ˆ",
  "tags": ["è®¾è®¡", "è‰ºæœ¯"]
}
```

**å“åº”**
```json
{
  "success": true,
  "data": {
    "id": "user_123",
    "nickname": "æ–°æ˜µç§°",
    "bio": "æ–°çš„ä¸ªäººç®€ä»‹",
    // ...å…¶ä»–å­—æ®µ
  }
}
```

---

### 4. ä¿®æ”¹å¯†ç 

**PUT** `/users/password`

**è¯·æ±‚å¤´**
```
Authorization: Bearer {token}
```

**è¯·æ±‚ä½“**
```json
{
  "oldPassword": "old_password",
  "newPassword": "new_password"
}
```

**å“åº”**
```json
{
  "success": true,
  "message": "å¯†ç ä¿®æ”¹æˆåŠŸ"
}
```

---

### 5. è·å–ç”¨æˆ·ç»Ÿè®¡

**GET** `/users/stats/:id?`

**è¯·æ±‚å¤´**
```
Authorization: Bearer {token}
```

**è¯´æ˜**: ä¸ä¼  id åˆ™è·å–å½“å‰ç”¨æˆ·çš„ç»Ÿè®¡

**å“åº”**
```json
{
  "success": true,
  "data": {
    "createdSurveys": 10,
    "completedSurveys": 50,
    "points": 500,
    "level": 5,
    "badges": 8,
    "favorites": 15
  }
}
```

---

### 6. è·å–ç”¨æˆ·çš„é—®å·åˆ—è¡¨

**GET** `/users/surveys/:id?`

**Query å‚æ•°**
| å‚æ•° | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|------|------|------|------|
| page | number | âŒ | é¡µç  |
| limit | number | âŒ | æ¯é¡µæ•°é‡ |
| status | string | âŒ | çŠ¶æ€ç­›é€‰: draft/pending/published |

**å“åº”**
```json
{
  "success": true,
  "data": {
    "surveys": [...],
    "total": 10,
    "page": 1,
    "totalPages": 1
  }
}
```

---

### 7. è·å–ç”¨æˆ·çš„ç­”é¢˜è®°å½•

**GET** `/users/answers/:id?`

**Query å‚æ•°**
| å‚æ•° | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|------|------|------|------|
| page | number | âŒ | é¡µç  |
| limit | number | âŒ | æ¯é¡µæ•°é‡ |

**å“åº”**
```json
{
  "success": true,
  "data": {
    "answers": [
      {
        "id": "answer_123",
        "surveyId": "survey_456",
        "surveyTitle": "é—®å·æ ‡é¢˜",
        "score": 85,
        "submittedAt": "2024-01-01T10:00:00.000Z"
      }
    ],
    "total": 20,
    "page": 1,
    "totalPages": 2
  }
}
```

---

### 8. è·å–ç”¨æˆ·çš„æ”¶è—åˆ—è¡¨

**GET** `/users/favorites/:id?`

**å“åº”**
```json
{
  "success": true,
  "data": {
    "favorites": [
      {
        "id": "fav_123",
        "surveyId": "survey_456",
        "survey": {
          "id": "survey_456",
          "title": "é—®å·æ ‡é¢˜",
          "category": "å­¦æœ¯è°ƒç ”",
          "rating": 4.5
        },
        "createdAt": "2024-01-01T10:00:00.000Z"
      }
    ],
    "total": 15
  }
}
```

---

### 9. è·å–ç§¯åˆ†å†å²

**GET** `/users/points/:id?`

**å“åº”**
```json
{
  "success": true,
  "data": {
    "history": [
      {
        "id": "point_123",
        "points": 10,
        "action": "å®Œæˆé—®å·",
        "description": "å®Œæˆé—®å·ã€Šxxxã€‹",
        "createdAt": "2024-01-01T10:00:00.000Z"
      }
    ],
    "total": 50
  }
}
```

---

## ğŸ“ é—®å·æ¥å£ (`/api/surveys`)

### 1. è·å–é—®å·åˆ—è¡¨

**GET** `/surveys`

**Query å‚æ•°**
| å‚æ•° | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|------|------|------|------|
| page | number | âŒ | é¡µç ï¼Œé»˜è®¤1 |
| limit | number | âŒ | æ¯é¡µæ•°é‡ï¼Œé»˜è®¤10 |
| category | string | âŒ | åˆ†ç±»ç­›é€‰ |
| keyword | string | âŒ | æœç´¢å…³é”®è¯ |
| status | string | âŒ | çŠ¶æ€: published/draft/pending |
| sort | string | âŒ | æ’åº: createdAt/rating/participants |

**å“åº”**
```json
{
  "success": true,
  "data": {
    "surveys": [
      {
        "id": "survey_123",
        "title": "é—®å·æ ‡é¢˜",
        "description": "é—®å·æè¿°",
        "category": "å­¦æœ¯è°ƒç ”",
        "questions": 10,
        "participants": 100,
        "rating": 4.5,
        "status": "published",
        "creator": {
          "id": "user_456",
          "username": "author",
          "nickname": "ä½œè€…"
        },
        "createdAt": "2024-01-01T00:00:00.000Z",
        "publishedAt": "2024-01-02T00:00:00.000Z"
      }
    ],
    "total": 50,
    "page": 1,
    "totalPages": 5
  }
}
```

---

### 2. è·å–é—®å·è¯¦æƒ…

**GET** `/surveys/:id`

**å“åº”**
```json
{
  "success": true,
  "data": {
    "id": "survey_123",
    "title": "é—®å·æ ‡é¢˜",
    "description": "é—®å·æè¿°",
    "category": "å­¦æœ¯è°ƒç ”",
    "tags": ["æ ‡ç­¾1", "æ ‡ç­¾2"],
    "questionList": [
      {
        "id": "q1",
        "type": "choice",
        "title": "é¢˜ç›®1",
        "options": ["é€‰é¡¹A", "é€‰é¡¹B", "é€‰é¡¹C"],
        "required": true
      },
      {
        "id": "q2",
        "type": "text",
        "title": "é¢˜ç›®2",
        "required": false
      }
    ],
    "settings": {
      "allowAnonymous": true,
      "showProgress": true,
      "randomOrder": false
    },
    "participants": 100,
    "responses": 95,
    "rating": 4.5,
    "ratingCount": 20,
    "favoriteCount": 15,
    "creator": {
      "id": "user_456",
      "username": "author",
      "nickname": "ä½œè€…",
      "avatar": "https://..."
    },
    "createdAt": "2024-01-01T00:00:00.000Z",
    "publishedAt": "2024-01-02T00:00:00.000Z"
  }
}
```

---

### 3. åˆ›å»ºé—®å·

**POST** `/surveys`

**è¯·æ±‚å¤´**
```
Authorization: Bearer {token}
```

**è¯·æ±‚ä½“**
```json
{
  "title": "æ–°é—®å·æ ‡é¢˜",
  "description": "é—®å·æè¿°",
  "category": "å­¦æœ¯è°ƒç ”",
  "categoryId": "cat_123",
  "tags": ["æ ‡ç­¾1", "æ ‡ç­¾2"],
  "questionList": [
    {
      "id": "q1",
      "type": "choice",
      "title": "æ‚¨çš„æ€§åˆ«æ˜¯ï¼Ÿ",
      "options": ["ç”·", "å¥³", "å…¶ä»–"],
      "required": true
    },
    {
      "id": "q2",
      "type": "text",
      "title": "æ‚¨çš„å»ºè®®",
      "required": false
    }
  ],
  "settings": {
    "allowAnonymous": true,
    "showProgress": true,
    "randomOrder": false
  },
  "status": "draft"
}
```

**å“åº”**
```json
{
  "success": true,
  "data": {
    "id": "survey_new_123",
    "title": "æ–°é—®å·æ ‡é¢˜",
    "status": "draft",
    // ...å…¶ä»–å­—æ®µ
  }
}
```

---

### 4. æ›´æ–°é—®å·

**PUT** `/surveys/:id`

**è¯·æ±‚å¤´**
```
Authorization: Bearer {token}
```

**è¯·æ±‚ä½“**: åŒåˆ›å»ºé—®å·

**å“åº”**
```json
{
  "success": true,
  "data": {
    "id": "survey_123",
    // ...æ›´æ–°åçš„å­—æ®µ
  }
}
```

---

### 5. åˆ é™¤é—®å·

**DELETE** `/surveys/:id`

**è¯·æ±‚å¤´**
```
Authorization: Bearer {token}
```

**å“åº”**
```json
{
  "success": true,
  "message": "é—®å·å·²åˆ é™¤"
}
```

---

### 6. è·å–é—®å·ç»Ÿè®¡

**GET** `/surveys/:id/stats`

**è¯·æ±‚å¤´**
```
Authorization: Bearer {token}
```

**å“åº”**
```json
{
  "success": true,
  "data": {
    "surveyId": "survey_123",
    "title": "é—®å·æ ‡é¢˜",
    "totalResponses": 100,
    "completionRate": 0.95,
    "averageScore": 85.5,
    "averageDuration": 300,
    "questionStats": [
      {
        "questionId": "q1",
        "questionTitle": "æ‚¨çš„æ€§åˆ«æ˜¯ï¼Ÿ",
        "type": "choice",
        "totalAnswers": 100,
        "distribution": {
          "ç”·": 60,
          "å¥³": 35,
          "å…¶ä»–": 5
        }
      }
    ]
  }
}
```

---

### 7. æ”¶è—/å–æ¶ˆæ”¶è—é—®å·

**POST** `/surveys/:id/favorite`

**è¯·æ±‚å¤´**
```
Authorization: Bearer {token}
```

**å“åº”**
```json
{
  "success": true,
  "data": {
    "favorited": true
  }
}
```

---

### 8. æ£€æŸ¥æ˜¯å¦æ”¶è—

**GET** `/surveys/:id/favorite/check`

**è¯·æ±‚å¤´**
```
Authorization: Bearer {token}
```

**å“åº”**
```json
{
  "success": true,
  "data": {
    "favorited": true
  }
}
```

---

### 9. è·å–ç”¨æˆ·åˆ›å»ºçš„é—®å·

**GET** `/surveys/user/:userId`

**è¯·æ±‚å¤´**
```
Authorization: Bearer {token}
```

**Query å‚æ•°**
| å‚æ•° | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|------|------|------|------|
| status | string | âŒ | çŠ¶æ€ç­›é€‰ |
| page | number | âŒ | é¡µç  |
| limit | number | âŒ | æ¯é¡µæ•°é‡ |

**å“åº”**: åŒè·å–é—®å·åˆ—è¡¨

---

## âœï¸ ç­”é¢˜ç»“æœæ¥å£ (`/api/answers`)

### 1. æäº¤ç­”é¢˜ç»“æœ

**POST** `/answers`

**è¯·æ±‚å¤´**
```
Authorization: Bearer {token}
```

**è¯·æ±‚ä½“**
```json
{
  "surveyId": "survey_123",
  "surveyTitle": "é—®å·æ ‡é¢˜",
  "answers": [
    {
      "questionId": "q1",
      "question": "æ‚¨çš„æ€§åˆ«æ˜¯ï¼Ÿ",
      "answer": "ç”·",
      "text": "ç”·"
    },
    {
      "questionId": "q2",
      "question": "æ‚¨çš„å»ºè®®",
      "answer": "å»ºè®®å†…å®¹",
      "text": "å»ºè®®å†…å®¹"
    }
  ],
  "score": 85,
  "result": "è‰¯å¥½",
  "duration": 300
}
```

**å“åº”**
```json
{
  "success": true,
  "data": {
    "id": "answer_new_123",
    "surveyId": "survey_123",
    "userId": "user_456",
    "score": 85,
    "submittedAt": "2024-01-01T10:00:00.000Z"
  }
}
```

---

### 2. è·å–ç­”é¢˜ç»“æœåˆ—è¡¨

**GET** `/answers`

**è¯·æ±‚å¤´**
```
Authorization: Bearer {token}
```

**Query å‚æ•°**
| å‚æ•° | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|------|------|------|------|
| userId | string | âŒ | æŒ‰ç”¨æˆ·ç­›é€‰ |
| surveyId | string | âŒ | æŒ‰é—®å·ç­›é€‰ |
| page | number | âŒ | é¡µç  |
| limit | number | âŒ | æ¯é¡µæ•°é‡ |

**å“åº”**
```json
{
  "success": true,
  "data": {
    "answers": [...],
    "total": 20,
    "page": 1,
    "totalPages": 2
  }
}
```

---

### 3. è·å–ç­”é¢˜ç»“æœè¯¦æƒ…

**GET** `/answers/:id`

**è¯·æ±‚å¤´**
```
Authorization: Bearer {token}
```

**å“åº”**
```json
{
  "success": true,
  "data": {
    "id": "answer_123",
    "surveyId": "survey_456",
    "surveyTitle": "é—®å·æ ‡é¢˜",
    "userId": "user_789",
    "answers": [...],
    "score": 85,
    "result": "è‰¯å¥½",
    "duration": 300,
    "submittedAt": "2024-01-01T10:00:00.000Z"
  }
}
```

---

### 4. è·å–ç”¨æˆ·åœ¨æŸé—®å·çš„ç­”é¢˜ç»“æœ

**GET** `/answers/survey/:surveyId`

**è¯·æ±‚å¤´**
```
Authorization: Bearer {token}
```

**å“åº”**: åŒè·å–ç­”é¢˜ç»“æœè¯¦æƒ…

---

### 5. æ£€æŸ¥ç”¨æˆ·æ˜¯å¦å·²ç­”è¿‡é—®å·

**GET** `/answers/survey/:surveyId/check`

**è¯·æ±‚å¤´**
```
Authorization: Bearer {token}
```

**å“åº”**
```json
{
  "success": true,
  "data": {
    "answered": true,
    "answerId": "answer_123"
  }
}
```

---

### 6. åˆ é™¤ç­”é¢˜ç»“æœ

**DELETE** `/answers/:id`

**è¯·æ±‚å¤´**
```
Authorization: Bearer {token}
```

**å“åº”**
```json
{
  "success": true,
  "message": "ç­”é¢˜ç»“æœå·²åˆ é™¤"
}
```

---

## ğŸ’¬ è¯„è®ºæ¥å£ (`/api/comments`)

### 1. è·å–é—®å·è¯„è®º

**GET** `/comments/survey/:surveyId`

**Query å‚æ•°**
| å‚æ•° | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|------|------|------|------|
| page | number | âŒ | é¡µç  |
| limit | number | âŒ | æ¯é¡µæ•°é‡ |

**å“åº”**
```json
{
  "success": true,
  "data": {
    "comments": [
      {
        "id": "comment_123",
        "content": "è¯„è®ºå†…å®¹",
        "rating": 5,
        "user": {
          "id": "user_456",
          "username": "user1",
          "nickname": "ç”¨æˆ·1",
          "avatar": "https://..."
        },
        "createdAt": "2024-01-01T10:00:00.000Z"
      }
    ],
    "total": 10,
    "page": 1,
    "totalPages": 1
  }
}
```

---

### 2. åˆ›å»ºè¯„è®º

**POST** `/comments/survey/:surveyId`

**è¯·æ±‚å¤´**
```
Authorization: Bearer {token}
```

**è¯·æ±‚ä½“**
```json
{
  "content": "è¿™æ˜¯ä¸€æ¡è¯„è®º",
  "rating": 5
}
```

**å“åº”**
```json
{
  "success": true,
  "data": {
    "id": "comment_new_123",
    "surveyId": "survey_456",
    "userId": "user_789",
    "content": "è¿™æ˜¯ä¸€æ¡è¯„è®º",
    "rating": 5,
    "createdAt": "2024-01-01T10:00:00.000Z"
  }
}
```

---

### 3. æ›´æ–°è¯„è®º

**PUT** `/comments/:id`

**è¯·æ±‚å¤´**
```
Authorization: Bearer {token}
```

**è¯·æ±‚ä½“**
```json
{
  "content": "ä¿®æ”¹åçš„è¯„è®º",
  "rating": 4
}
```

**å“åº”**: åŒåˆ›å»ºè¯„è®º

---

### 4. åˆ é™¤è¯„è®º

**DELETE** `/comments/:id`

**è¯·æ±‚å¤´**
```
Authorization: Bearer {token}
```

**å“åº”**
```json
{
  "success": true,
  "message": "è¯„è®ºå·²åˆ é™¤"
}
```

---

## ğŸ·ï¸ åˆ†ç±»æ¥å£ (`/api/categories`)

### 1. è·å–æ‰€æœ‰åˆ†ç±»

**GET** `/categories`

**å“åº”**
```json
{
  "success": true,
  "data": [
    {
      "id": "cat_1",
      "name": "å­¦æœ¯è°ƒç ”",
      "slug": "academic",
      "description": "å­¦æœ¯ç ”ç©¶ç›¸å…³é—®å·",
      "icon": "ğŸ“š",
      "surveyCount": 50
    },
    {
      "id": "cat_2",
      "name": "å¸‚åœºè°ƒæŸ¥",
      "slug": "market",
      "description": "å¸‚åœºè°ƒç ”é—®å·",
      "icon": "ğŸ“Š",
      "surveyCount": 30
    }
  ]
}
```

---

### 2. è·å–å•ä¸ªåˆ†ç±»

**GET** `/categories/:id`

**å“åº”**
```json
{
  "success": true,
  "data": {
    "id": "cat_1",
    "name": "å­¦æœ¯è°ƒç ”",
    "slug": "academic",
    "description": "å­¦æœ¯ç ”ç©¶ç›¸å…³é—®å·",
    "icon": "ğŸ“š",
    "surveyCount": 50
  }
}
```

---

### 3. é€šè¿‡ slug è·å–åˆ†ç±»

**GET** `/categories/slug/:slug`

**å“åº”**: åŒè·å–å•ä¸ªåˆ†ç±»

---

### 4. åˆ›å»ºåˆ†ç±» (ç®¡ç†å‘˜)

**POST** `/categories`

**è¯·æ±‚å¤´**
```
Authorization: Bearer {admin_token}
```

**è¯·æ±‚ä½“**
```json
{
  "name": "æ–°åˆ†ç±»",
  "slug": "new-category",
  "description": "åˆ†ç±»æè¿°",
  "icon": "ğŸ¯"
}
```

**å“åº”**
```json
{
  "success": true,
  "data": {
    "id": "cat_new",
    "name": "æ–°åˆ†ç±»",
    "slug": "new-category",
    // ...
  }
}
```

---

### 5. æ›´æ–°åˆ†ç±» (ç®¡ç†å‘˜)

**PUT** `/categories/:id`

**è¯·æ±‚å¤´**
```
Authorization: Bearer {admin_token}
```

**è¯·æ±‚ä½“**: åŒåˆ›å»ºåˆ†ç±»

**å“åº”**: åŒåˆ›å»ºåˆ†ç±»

---

### 6. åˆ é™¤åˆ†ç±» (ç®¡ç†å‘˜)

**DELETE** `/categories/:id`

**è¯·æ±‚å¤´**
```
Authorization: Bearer {admin_token}
```

**å“åº”**
```json
{
  "success": true,
  "message": "åˆ†ç±»å·²åˆ é™¤"
}
```

---

## ğŸ… å¾½ç« æ¥å£ (`/api/badges`)

### 1. è·å–æ‰€æœ‰å¾½ç« 

**GET** `/badges`

**å“åº”**
```json
{
  "success": true,
  "data": [
    {
      "id": "badge_1",
      "name": "æ–°æ‰‹ä¸Šè·¯",
      "description": "å®Œæˆç¬¬ä¸€ä¸ªé—®å·",
      "icon": "ğŸ–ï¸",
      "requirement": 1,
      "type": "survey_completed"
    }
  ]
}
```

---

### 2. è·å–å•ä¸ªå¾½ç« 

**GET** `/badges/:id`

**å“åº”**: åŒè·å–æ‰€æœ‰å¾½ç« çš„å•é¡¹

---

## ğŸ“Š æŠ¥å‘Šæ¥å£ (`/api/reports`)

### 1. ç”ŸæˆæŠ¥å‘Š

**POST** `/reports/generate`

**è¯·æ±‚å¤´**
```
Authorization: Bearer {token}
```

**è¯·æ±‚ä½“**
```json
{
  "surveyId": "survey_123",
  "surveyTitle": "é—®å·æ ‡é¢˜",
  "category": "å¿ƒç†æµ‹è¯•",
  "answers": [
    {
      "question": "é¢˜ç›®1",
      "text": "ç­”æ¡ˆ1"
    },
    {
      "question": "é¢˜ç›®2",
      "text": "ç­”æ¡ˆ2"
    }
  ]
}
```

**å“åº”**
```json
{
  "success": true,
  "data": {
    "reportId": "report_123",
    "status": "completed",
    "content": "# ä¸ªäººåˆ†ææŠ¥å‘Š\n\næ ¹æ®æ‚¨çš„ç­”æ¡ˆ...",
    "generatedAt": "2024-01-01T10:05:00.000Z"
  }
}
```

---

### 2. è·å–æŠ¥å‘ŠçŠ¶æ€

**GET** `/reports/:id/status`

**è¯·æ±‚å¤´**
```
Authorization: Bearer {token}
```

**å“åº”**
```json
{
  "success": true,
  "data": {
    "id": "report_123",
    "status": "completed",
    "generatedAt": "2024-01-01T10:05:00.000Z"
  }
}
```

**çŠ¶æ€è¯´æ˜**
- `generating` - ç”Ÿæˆä¸­
- `completed` - å·²å®Œæˆ
- `failed` - ç”Ÿæˆå¤±è´¥

---

### 3. è·å–æŠ¥å‘Šè¯¦æƒ…

**GET** `/reports/:id`

**è¯·æ±‚å¤´**
```
Authorization: Bearer {token}
```

**å“åº”**
```json
{
  "success": true,
  "data": {
    "id": "report_123",
    "userId": "user_456",
    "surveyId": "survey_789",
    "title": "å¿ƒç†æµ‹è¯• - ä¸ªäººåˆ†ææŠ¥å‘Š",
    "surveyTitle": "å¿ƒç†æµ‹è¯•",
    "category": "å¿ƒç†æµ‹è¯•",
    "content": "# ä¸ªäººåˆ†ææŠ¥å‘Š\n\n...",
    "status": "completed",
    "generatedAt": "2024-01-01T10:05:00.000Z",
    "createdAt": "2024-01-01T10:00:00.000Z"
  }
}
```

---

### 4. è·å–ç”¨æˆ·æ‰€æœ‰æŠ¥å‘Š

**GET** `/reports`

**è¯·æ±‚å¤´**
```
Authorization: Bearer {token}
```

**Query å‚æ•°**
| å‚æ•° | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|------|------|------|------|
| page | number | âŒ | é¡µç  |
| limit | number | âŒ | æ¯é¡µæ•°é‡ |
| status | string | âŒ | çŠ¶æ€ç­›é€‰ |

**å“åº”**
```json
{
  "success": true,
  "data": {
    "reports": [...],
    "total": 5,
    "page": 1,
    "totalPages": 1
  }
}
```

---

### 5. ä¸‹è½½æŠ¥å‘Š (PDF)

**GET** `/reports/:id/download`

**è¯·æ±‚å¤´**
```
Authorization: Bearer {token}
```

**å“åº”**: PDF æ–‡ä»¶æµ

---

### 6. åˆ é™¤æŠ¥å‘Š

**DELETE** `/reports/:id`

**è¯·æ±‚å¤´**
```
Authorization: Bearer {token}
```

**å“åº”**
```json
{
  "success": true,
  "message": "æŠ¥å‘Šå·²åˆ é™¤"
}
```

---

## ğŸ”§ ç®¡ç†å‘˜æ¥å£ (`/api/admin`)

**æ‰€æœ‰ç®¡ç†å‘˜æ¥å£éƒ½éœ€è¦ç®¡ç†å‘˜æƒé™**

### 1. ä»ªè¡¨æ¿ç»Ÿè®¡

**GET** `/admin/dashboard/stats`

**è¯·æ±‚å¤´**
```
Authorization: Bearer {admin_token}
```

**å“åº”**
```json
{
  "success": true,
  "data": {
    "users": {
      "total": 1000,
      "today": 20
    },
    "surveys": {
      "total": 500,
      "pending": 10,
      "published": 450
    },
    "answers": {
      "total": 5000,
      "today": 100
    }
  }
}
```

---

### 2. è·å–æ‰€æœ‰ç”¨æˆ·

**GET** `/admin/users`

**è¯·æ±‚å¤´**
```
Authorization: Bearer {admin_token}
```

**Query å‚æ•°**: page, limit

**å“åº”**: åŒ `/api/users`

---

### 3. æ›´æ–°ç”¨æˆ·è§’è‰²

**PUT** `/admin/users/:id/role`

**è¯·æ±‚å¤´**
```
Authorization: Bearer {admin_token}
```

**è¯·æ±‚ä½“**
```json
{
  "role": "admin"
}
```

**å“åº”**
```json
{
  "success": true,
  "message": "ç”¨æˆ·è§’è‰²å·²æ›´æ–°"
}
```

---

### 4. åˆ é™¤ç”¨æˆ·

**DELETE** `/admin/users/:id`

**è¯·æ±‚å¤´**
```
Authorization: Bearer {admin_token}
```

**å“åº”**
```json
{
  "success": true,
  "message": "ç”¨æˆ·å·²åˆ é™¤"
}
```

---

### 5. å®¡æ ¸é—®å·

**PUT** `/admin/surveys/:id/review`

**è¯·æ±‚å¤´**
```
Authorization: Bearer {admin_token}
```

**è¯·æ±‚ä½“**
```json
{
  "action": "approve",
  "reason": "å®¡æ ¸é€šè¿‡"
}
```

**å‚æ•°è¯´æ˜**
- `action`: "approve" (é€šè¿‡) æˆ– "reject" (æ‹’ç»)
- `reason`: å®¡æ ¸æ„è§

**å“åº”**
```json
{
  "success": true,
  "message": "é—®å·å·²é€šè¿‡å®¡æ ¸"
}
```

---

### 6. è·å–æ‰€æœ‰å…¬å‘Š

**GET** `/admin/announcements`

**è¯·æ±‚å¤´**
```
Authorization: Bearer {admin_token}
```

**å“åº”**
```json
{
  "success": true,
  "data": {
    "announcements": [
      {
        "id": "ann_1",
        "title": "å…¬å‘Šæ ‡é¢˜",
        "content": "å…¬å‘Šå†…å®¹",
        "type": "info",
        "createdAt": "2024-01-01T00:00:00.000Z"
      }
    ],
    "total": 5
  }
}
```

---

### 7. åˆ›å»ºå…¬å‘Š

**POST** `/admin/announcements`

**è¯·æ±‚å¤´**
```
Authorization: Bearer {admin_token}
```

**è¯·æ±‚ä½“**
```json
{
  "title": "æ–°å…¬å‘Š",
  "content": "å…¬å‘Šå†…å®¹",
  "type": "info"
}
```

**å“åº”**
```json
{
  "success": true,
  "data": {
    "id": "ann_new",
    "title": "æ–°å…¬å‘Š",
    // ...
  }
}
```

---

### 8. æ›´æ–°å…¬å‘Š

**PUT** `/admin/announcements/:id`

**è¯·æ±‚å¤´**
```
Authorization: Bearer {admin_token}
```

**è¯·æ±‚ä½“**: åŒåˆ›å»ºå…¬å‘Š

**å“åº”**: åŒåˆ›å»ºå…¬å‘Š

---

### 9. åˆ é™¤å…¬å‘Š

**DELETE** `/admin/announcements/:id`

**è¯·æ±‚å¤´**
```
Authorization: Bearer {admin_token}
```

**å“åº”**
```json
{
  "success": true,
  "message": "å…¬å‘Šå·²åˆ é™¤"
}
```

---

### 10. è·å–ç®¡ç†å‘˜æ´»åŠ¨æ—¥å¿—

**GET** `/admin/activities`

**è¯·æ±‚å¤´**
```
Authorization: Bearer {admin_token}
```

**Query å‚æ•°**: page, limit

**å“åº”**
```json
{
  "success": true,
  "data": {
    "activities": [
      {
        "id": "act_1",
        "adminId": "admin_123",
        "action": "å®¡æ ¸é—®å·: é€šè¿‡",
        "targetType": "survey",
        "targetId": "survey_456",
        "details": "å®¡æ ¸é€šè¿‡",
        "createdAt": "2024-01-01T10:00:00.000Z"
      }
    ],
    "total": 100
  }
}
```

---

### 11. åˆ›å»ºæ´»åŠ¨æ—¥å¿—

**POST** `/admin/activities`

**è¯·æ±‚å¤´**
```
Authorization: Bearer {admin_token}
```

**è¯·æ±‚ä½“**
```json
{
  "action": "æ“ä½œæè¿°",
  "targetType": "survey",
  "targetId": "survey_123",
  "details": "è¯¦ç»†ä¿¡æ¯"
}
```

**å“åº”**
```json
{
  "success": true,
  "data": {
    "id": "act_new",
    // ...
  }
}
```

---

## ğŸ“¢ å…¬å‘Šæ¥å£ (`/api/announcements`)

### 1. è·å–å…¬å‘Šåˆ—è¡¨ (å…¬å¼€)

**GET** `/announcements`

**Query å‚æ•°**
| å‚æ•° | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|------|------|------|------|
| page | number | âŒ | é¡µç  |
| limit | number | âŒ | æ¯é¡µæ•°é‡ |
| type | string | âŒ | ç±»å‹ç­›é€‰ |

**å“åº”**: åŒç®¡ç†å‘˜è·å–æ‰€æœ‰å…¬å‘Š

---

## ğŸ—‘ï¸ å›æ”¶ç«™æ¥å£ (`/api/recycleBin`)

### 1. è·å–å›æ”¶ç«™åˆ—è¡¨

**GET** `/recycleBin`

**è¯·æ±‚å¤´**
```
Authorization: Bearer {token}
```

**å“åº”**
```json
{
  "success": true,
  "data": {
    "items": [
      {
        "id": "recycle_1",
        "itemType": "survey",
        "itemId": "survey_123",
        "itemData": {...},
        "deletedAt": "2024-01-01T10:00:00.000Z"
      }
    ]
  }
}
```

---

## â­ æ”¶è—æ¥å£ (`/api/favorites`)

### 1. è·å–æˆ‘çš„æ”¶è—

**GET** `/favorites`

**è¯·æ±‚å¤´**
```
Authorization: Bearer {token}
```

**å“åº”**: åŒ `/api/users/favorites`

---

## ğŸ“Œ é”™è¯¯ç è¯´æ˜

| é”™è¯¯ç  | è¯´æ˜ | ç¤ºä¾‹ |
|--------|------|------|
| 400 | è¯·æ±‚å‚æ•°é”™è¯¯ | ç¼ºå°‘å¿…å¡«å­—æ®µ |
| 401 | æœªè®¤è¯ | Token æ— æ•ˆæˆ–è¿‡æœŸ |
| 403 | æ— æƒé™ | éç®¡ç†å‘˜è®¿é—®ç®¡ç†æ¥å£ |
| 404 | èµ„æºä¸å­˜åœ¨ | é—®å·IDä¸å­˜åœ¨ |
| 409 | å†²çª | ç”¨æˆ·åå·²å­˜åœ¨ |
| 500 | æœåŠ¡å™¨é”™è¯¯ | æ•°æ®åº“è¿æ¥å¤±è´¥ |

---

## ğŸ”’ è®¤è¯è¯´æ˜

å¤§éƒ¨åˆ†æ¥å£éœ€è¦åœ¨è¯·æ±‚å¤´ä¸­æºå¸¦ JWT Tokenï¼š

```
Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
```

Token æœ‰æ•ˆæœŸ: 7å¤©

---

## ğŸ“ æ³¨æ„äº‹é¡¹

1. æ‰€æœ‰æ—¥æœŸæ—¶é—´æ ¼å¼ä¸º ISO 8601 (UTC)
2. åˆ†é¡µé»˜è®¤ page=1, limit=10
3. æ–‡ä»¶ä¸Šä¼ å¤§å°é™åˆ¶: 10MB
4. API è°ƒç”¨é¢‘ç‡é™åˆ¶: 100æ¬¡/åˆ†é’Ÿ (å¯é…ç½®)
5. æ‰€æœ‰æ¥å£æ”¯æŒ CORS

---

**æ–‡æ¡£ç‰ˆæœ¬**: v1.0  
**æœ€åæ›´æ–°**: 2025å¹´12æœˆ1æ—¥
