# 问卷系统 - 需求分析文档

## 📋 文档信息

- **项目名称**：基于 Vue 和 Node.js 的问卷系统
- **文档版本**：v1.0
- **编写日期**：2025 年 12 月 2 日
- **文档作者**：项目组
- **更新日期**：2025 年 12 月 2 日

---

## 第一章 引言

### 1.1 编写目的

本需求分析文档旨在全面、准确地描述基于 Vue 和 Node.js 的问卷系统的功能需求、性能需求、设计约束等，为系统设计、开发、测试提供依据。

本文档的预期读者包括：

- 项目开发人员
- 系统测试人员
- 项目管理人员
- 系统维护人员
- 毕业设计指导教师

### 1.2 项目背景

#### 1.2.1 项目背景

随着互联网技术的快速发展和移动设备的普及，在线问卷调查已成为数据收集的主流方式，广泛应用于教育评估、市场调研、用户研究、心理测评等领域。然而，现有问卷系统普遍存在以下问题：

1. **用户体验问题**：

   - 界面单调，交互僵化，缺乏趣味性
   - 填写过程枯燥，用户容易产生疲劳感
   - 缺乏即时反馈和互动体验

2. **功能局限性**：

   - 题型支持有限，无法满足复杂调研需求
   - 逻辑跳转功能简单，难以实现智能分支
   - 缺乏个性化推荐机制

3. **数据分析不足**：

   - 仅提供基础统计功能
   - 缺乏深度数据挖掘和个性化反馈
   - 用户无法获得有价值的自我认知

4. **激励机制缺失**：
   - 缺乏有效的用户激励措施
   - 问卷完成率和数据质量难以保证
   - 用户粘性和留存率低

#### 1.2.2 项目目标

本项目旨在设计并实现一个融合**游戏化设计**和**AI 智能分析**的现代化问卷系统，具体目标包括：

1. **提升用户体验**：

   - 通过游戏化设计提高问卷填写趣味性
   - 提供丰富的动画反馈和视觉效果
   - 实现沉浸式的答题体验

2. **丰富功能特性**：

   - 支持多种题型和复杂逻辑跳转
   - 提供问卷模板和快速创建功能
   - 实现个性化问卷推荐

3. **智能数据分析**：

   - 集成 AI 技术生成个性化分析报告
   - 提供多维度数据可视化
   - 为用户提供超越传统统计的深度反馈

4. **增强用户激励**：
   - 建立积分和成就系统
   - 实现排行榜和社交互动
   - 提高问卷完成率和数据质量

### 1.3 术语定义

| 术语              | 定义                                             |
| ----------------- | ------------------------------------------------ |
| **问卷**          | 由一组问题组成的调查工具，用于收集用户信息和意见 |
| **题目/问题**     | 问卷中的单个问题项                               |
| **题型**          | 问题的类型，如单选题、多选题、填空题等           |
| **答卷/答题记录** | 用户填写问卷后提交的答案数据                     |
| **跳转逻辑**      | 根据用户答案动态显示或隐藏后续题目的规则         |
| **游戏化设计**    | 将游戏元素和机制应用于非游戏场景的设计理念       |
| **积分系统**      | 用户完成任务获得积分的激励机制                   |
| **成就徽章**      | 用户达成特定条件后解锁的虚拟奖励                 |
| **AI 报告**       | 基于大语言模型分析用户答案生成的个性化报告       |
| **问卷模板**      | 预设的问卷结构，用户可基于模板快速创建问卷       |
| **回收站**        | 存储已删除问卷的临时区域，支持恢复功能           |

### 1.4 参考资料

1. **技术文档**：

   - Vue 3 官方文档：https://vuejs.org/
   - Element Plus 文档：https://element-plus.org/
   - Express 官方文档：https://expressjs.com/
   - Sequelize ORM 文档：https://sequelize.org/

2. **设计理论**：

   - Werbach & Hunter (2012). "For the Win: How Game Thinking Can Revolutionize Your Business"
   - Ryan & Deci (2000). "Self-Determination Theory"
   - Nielsen Norman Group - UX Design Guidelines

3. **相关标准**：
   - GB/T 25000.51-2016 软件工程 软件产品质量要求与评价
   - ISO/IEC 25010:2011 系统与软件质量模型

---

## 第二章 项目概述

### 2.1 产品描述

本系统是一个基于**前后端分离架构**的在线问卷调查平台，采用**Vue 3 + Node.js + MySQL**技术栈，融合**游戏化交互设计**和**AI 智能分析**，为用户提供问卷创建、发布、填写、数据统计、个性化报告生成等全流程服务。

#### 2.1.1 产品定位

- **面向用户**：教育工作者、企业 HR、市场调研人员、心理咨询师、普通参与者
- **应用场景**：学术研究、课程评估、员工调研、市场分析、心理测评、兴趣调查
- **核心价值**：通过游戏化设计提升体验，通过 AI 分析提供价值

#### 2.1.2 产品特色

1. **游戏化交互**：

   - 动态进度动画（液体填充、树木生长、圆形进度）
   - 答题反馈动画（粒子爆发、奖杯、思考表情）
   - 积分系统、成就徽章、排行榜

2. **AI 智能分析**：

   - 基于扣子平台 API 的智能分析
   - 生成职业倾向、学习能力、心理画像等多维报告
   - 支持图文报告下载

3. **丰富题型支持**：

   - 单选题、多选题、填空题、评分题
   - 拖拽排序题、滑块题
   - 支持图片、视频等多媒体

4. **灵活逻辑控制**：
   - 题目跳转逻辑
   - 条件分支设置
   - 动态题目显示

### 2.2 用户角色

| 角色           | 描述                             | 主要功能                                                   |
| -------------- | -------------------------------- | ---------------------------------------------------------- |
| **普通用户**   | 填写问卷、创建个人问卷的注册用户 | 浏览问卷、填写问卷、查看报告、创建问卷、收藏问卷、评论互动 |
| **问卷创建者** | 创建并发布问卷的用户             | 创建问卷、编辑问卷、发布问卷、查看统计、管理评论           |
| **系统管理员** | 管理系统内容和用户的管理人员     | 用户管理、问卷审核、内容管理、数据统计、公告发布           |
| **游客**       | 未登录的访问者                   | 浏览公开问卷、查看排行榜（功能受限）                       |

### 2.3 运行环境

#### 2.3.1 硬件环境

**服务器端**：

- CPU：2 核心及以上
- 内存：4GB 及以上
- 硬盘：50GB 及以上
- 网络：10Mbps 及以上

**客户端**：

- 支持运行现代浏览器的设备（PC、平板、手机）
- 屏幕分辨率：最低 1280×720

#### 2.3.2 软件环境

**服务器端**：

- 操作系统：Linux / Windows Server / macOS
- Node.js：16.x 或更高版本
- MySQL：5.7 或更高版本
- Nginx / Apache（可选，用于反向代理）

**客户端**：

- 浏览器：
  - Chrome 90+
  - Firefox 88+
  - Safari 14+
  - Edge 90+
- 操作系统：Windows / macOS / Linux / iOS / Android

#### 2.3.3 开发环境

- **前端**：Vue 3 + Vite + Element Plus + Pinia
- **后端**：Node.js + Express + Sequelize
- **数据库**：MySQL
- **AI 服务**：扣子平台（Coze）API
- **版本控制**：Git
- **开发工具**：VS Code

---

## 第三章 功能需求分析

### 3.1 用户端功能需求

#### 3.1.1 用户认证模块

**需求编号**：FR-U-001  
**需求描述**：提供用户注册、登录、登出、找回密码等身份认证功能

**详细需求**：

1. **用户注册（FR-U-001-01）**

   - 支持邮箱+密码注册
   - 邮箱唯一性验证
   - 密码强度校验（至少 6 位，包含字母和数字）
   - 自动发送欢迎邮件（可选）
   - 注册成功自动登录

2. **用户登录（FR-U-001-02）**

   - 支持邮箱/用户名+密码登录
   - 记住登录状态（7 天）
   - 登录失败提示（密码错误、账号不存在、账号被封禁）
   - Token 认证机制（JWT）

3. **找回密码（FR-U-001-03）**

   - 通过邮箱验证码重置密码
   - 验证码有效期 5 分钟
   - 新密码强度校验

4. **用户登出（FR-U-001-04）**
   - 清除本地 Token
   - 清除用户状态

**输入**：邮箱、密码、验证码  
**输出**：注册/登录成功，返回用户信息和 Token  
**优先级**：高

---

#### 3.1.2 个人中心模块

**需求编号**：FR-U-002  
**需求描述**：提供个人信息管理、头像修改、密码修改等功能

**详细需求**：

1. **个人信息管理（FR-U-002-01）**

   - 查看个人资料（昵称、邮箱、注册时间、积分、等级）
   - 修改昵称、简介
   - 显示答题统计（已答题数、创建问卷数）

2. **头像管理（FR-U-002-02）**

   - 上传头像（支持 jpg、png 格式，大小限制 5MB）
   - 头像裁剪预览
   - 支持默认头像

3. **密码修改（FR-U-002-03）**

   - 验证旧密码
   - 输入新密码（两次确认）
   - 密码强度校验

4. **积分与成就（FR-U-002-04）**

   - 查看当前积分和等级
   - 查看积分历史记录
   - 查看已解锁的成就徽章
   - 成就解锁条件说明

5. **答题历史（FR-U-002-05）**
   - 查看已填写的问卷列表
   - 支持按时间、分类筛选
   - 支持关键词搜索
   - 查看答题详情和 AI 报告

**输入**：用户修改的信息、头像文件、密码  
**输出**：更新成功提示、更新后的用户信息  
**优先级**：高

---

#### 3.1.3 问卷浏览与搜索模块

**需求编号**：FR-U-003  
**需求描述**：提供问卷分类浏览、关键词搜索、个性化推荐功能

**详细需求**：

1. **问卷分类（FR-U-003-01）**

   - 预设分类：学术调研、市场调查、心理测试、娱乐趣味、教育评估、其他
   - 点击分类查看该类问卷
   - 显示每个分类的问卷数量

2. **关键词搜索（FR-U-003-02）**

   - 支持按问卷标题、描述搜索
   - 模糊匹配
   - 搜索结果按相关度排序
   - 搜索历史记录（本地存储）

3. **个性化推荐（FR-U-003-03）**

   - 基于用户历史答题记录推荐
   - 基于用户收藏偏好推荐
   - 基于问卷热度推荐
   - 推荐算法：协同过滤 + 内容推荐

4. **排行榜（FR-U-003-04）**

   - 问卷参与人数排行
   - 问卷评分排行
   - 用户积分排行
   - 支持查看 TOP 100

5. **问卷筛选（FR-U-003-05）**
   - 按分类筛选
   - 按状态筛选（进行中、已结束）
   - 按难度筛选
   - 按时长筛选

**输入**：搜索关键词、筛选条件  
**输出**：符合条件的问卷列表  
**优先级**：高

---

#### 3.1.4 问卷填写模块

**需求编号**：FR-U-004  
**需求描述**：提供问卷填写、进度保存、动态反馈等功能

**详细需求**：

1. **问卷填写（FR-U-004-01）**

   - 支持多种题型：单选、多选、填空、评分、拖拽排序
   - 必填项校验
   - 答案实时保存（防止意外关闭丢失）
   - 题目编号和进度显示

2. **跳转逻辑（FR-U-004-02）**

   - 根据用户答案跳转到指定题目
   - 支持条件分支（if-else 逻辑）
   - 跳过不相关题目

3. **动态进度展示（FR-U-004-03）**

   - 三种进度动画随机展示：
     - 圆形进度条（SVG 动画）
     - 液体填充（Canvas 波浪动画）
     - 树木生长（Canvas 分形动画）
   - 实时更新进度百分比
   - 显示已答题数和剩余题数

4. **答题反馈（FR-U-004-04）**

   - 正确答案反馈：
     - 粒子爆发动画
     - 奖杯 3D 动画
     - 烟花效果
     - 光环脉冲
   - 错误答案反馈：
     - 思考表情动画
     - 问号气泡
     - 波纹扩散

5. **限时挑战模式（FR-U-004-05）**（可选）

   - 部分问卷支持限时模式
   - 倒计时显示
   - 超时自动提交
   - 根据正确率和用时计算得分

6. **答题计时（FR-U-004-06）**
   - 记录答题开始时间
   - 实时显示已用时间
   - 提交时记录总用时

**输入**：用户答案  
**输出**：答案保存成功、反馈动画、进度更新  
**优先级**：高

---

#### 3.1.5 问卷创建与编辑模块

**需求编号**：FR-U-005  
**需求描述**：提供可视化问卷编辑器，支持多种题型和逻辑设置

**详细需求**：

1. **问卷基本信息（FR-U-005-01）**

   - 设置问卷标题（必填，最多 100 字）
   - 设置问卷描述（可选，最多 500 字）
   - 选择分类
   - 设置预计时长
   - 上传封面图（可选）

2. **题目编辑（FR-U-005-02）**

   - 添加题目
   - 设置题目类型：
     - 单选题（设置选项、正确答案）
     - 多选题（设置选项、正确答案、最少/最多选择数）
     - 填空题（设置占位符、字数限制）
     - 评分题（设置评分范围、步长）
     - 拖拽排序题（设置待排序项）
     - 滑块题（设置数值范围）
   - 设置题目必填/选填
   - 设置题目分值（用于测评类问卷）
   - 上传题目图片/视频（可选）

3. **跳转逻辑设置（FR-U-005-03）**

   - 为题目设置跳转规则
   - 支持多条件跳转
   - 可视化逻辑流程图（可选）

4. **问卷模板（FR-U-005-04）**

   - 提供常用模板：
     - 满意度调查模板
     - 职业倾向测试模板
     - 学习风格评估模板
     - 课程评价模板
   - 基于模板创建问卷
   - 支持自定义修改

5. **问卷预览（FR-U-005-05）**

   - 实时预览问卷效果
   - 模拟答题流程
   - 检测跳转逻辑是否正确

6. **问卷保存与发布（FR-U-005-06）**
   - 保存为草稿
   - 提交审核（需管理员审核后发布）
   - 审核通过后自动发布
   - 已发布问卷可停止收集

**输入**：问卷标题、描述、题目、选项、逻辑规则  
**输出**：问卷保存成功、提交审核成功  
**优先级**：高

---

#### 3.1.6 收藏与评论模块

**需求编号**：FR-U-006  
**需求描述**：提供问卷收藏、评分、评论、回复功能

**详细需求**：

1. **问卷收藏（FR-U-006-01）**

   - 收藏感兴趣的问卷
   - 取消收藏
   - 查看收藏列表
   - 收藏数量统计

2. **问卷评分（FR-U-006-02）**

   - 完成问卷后可评分（1-5 星）
   - 显示问卷平均评分
   - 显示评分人数

3. **问卷评论（FR-U-006-03）**

   - 完成问卷后可评论
   - 评论内容长度限制（500 字）
   - 支持表情
   - 显示评论时间和用户信息

4. **评论回复（FR-U-006-04）**

   - 对评论进行回复
   - 支持@用户
   - 显示回复层级（最多 2 层）

5. **评论管理（FR-U-006-05）**
   - 用户可删除自己的评论
   - 问卷创建者可删除任何评论
   - 管理员可删除违规评论

**输入**：收藏操作、评分、评论内容  
**输出**：操作成功提示、评论列表更新  
**优先级**：中

---

#### 3.1.7 AI 报告生成模块

**需求编号**：FR-U-007  
**需求描述**：基于扣子平台 AI 生成个性化分析报告

**详细需求**：

1. **报告生成（FR-U-007-01）**

   - 用户完成问卷后触发报告生成
   - 调用扣子平台 API 分析答案
   - 支持的报告类型：
     - 职业倾向分析
     - 学习能力评估
     - 心理状态分析
     - 兴趣爱好分析
     - 性格特质分析

2. **报告展示（FR-U-007-02）**

   - 图文结合展示报告
   - 使用 ECharts 生成可视化图表：
     - 雷达图（多维能力）
     - 柱状图（各项得分）
     - 饼图（类型分布）
   - AI 生成的文字解读和建议

3. **报告下载（FR-U-007-03）**

   - 导出为 PDF 格式
   - 包含完整图表和文字
   - 添加生成时间和水印

4. **报告管理（FR-U-007-04）**
   - 查看历史报告列表
   - 支持按时间、问卷分类筛选
   - 删除报告

**输入**：用户答案数据  
**输出**：AI 生成的个性化报告  
**优先级**：高

---

#### 3.1.8 积分与成就系统

**需求编号**：FR-U-008  
**需求描述**：提供积分获取、成就解锁、排行榜等游戏化功能

**详细需求**：

1. **积分获取（FR-U-008-01）**

   - 完成问卷：+10 分
   - 创建问卷并发布：+20 分
   - 问卷被他人完成：+5 分/次
   - 收到评论：+2 分/次
   - 每日登录：+1 分

2. **积分消耗（FR-U-008-02）**（可选）

   - 解锁高级功能
   - 兑换虚拟奖励

3. **成就徽章（FR-U-008-03）**

   - 评测达人：完成 50 份问卷
   - 速通王者：限时模式满分 3 次
   - 社交之星：评论和收藏达 50 次
   - 创作先锋：创建并发布 10 份问卷
   - 人气之王：创建的问卷被 1000 人完成
   - 完美主义者：连续 10 份问卷满分

4. **等级系统（FR-U-008-04）**

   - 根据积分自动升级
   - 等级划分：
     - LV1：0-99 分（新手）
     - LV2：100-499 分（初级）
     - LV3：500-1999 分（中级）
     - LV4：2000-4999 分（高级）
     - LV5：5000+分（专家）

5. **排行榜（FR-U-008-05）**
   - 积分排行榜（周榜、月榜、总榜）
   - 显示用户头像、昵称、积分
   - 自己的排名高亮显示

**输入**：用户行为（答题、创建问卷等）  
**输出**：积分变化、成就解锁提示  
**优先级**：中

---

#### 3.1.9 我的问卷管理模块

**需求编号**：FR-U-009  
**需求描述**：管理用户创建的问卷，查看统计数据

**详细需求**：

1. **问卷状态管理（FR-U-009-01）**

   - 草稿：未提交的问卷
   - 待审核：已提交等待管理员审核
   - 已发布：审核通过并发布
   - 已停止：停止收集答案
   - 已删除：移入回收站

2. **问卷编辑（FR-U-009-02）**

   - 草稿状态可编辑
   - 已发布问卷不可编辑（可停止后编辑）

3. **问卷统计（FR-U-009-03）**

   - 查看参与人数
   - 查看完成率
   - 查看答案分布
   - 查看平均得分
   - 导出统计数据（Excel）

4. **回收站（FR-U-009-04）**
   - 查看已删除问卷
   - 恢复问卷
   - 永久删除

**输入**：问卷管理操作  
**输出**：问卷状态更新、统计数据  
**优先级**：高

---

### 3.2 管理端功能需求

#### 3.2.1 用户管理模块

**需求编号**：FR-A-001  
**需求描述**：管理员管理系统用户

**详细需求**：

1. **用户列表（FR-A-001-01）**

   - 查看所有用户
   - 显示用户名、邮箱、注册时间、积分、状态
   - 支持分页（每页 20 条）

2. **用户搜索（FR-A-001-02）**

   - 按用户名、邮箱搜索
   - 按注册时间筛选
   - 按状态筛选（正常、封禁）

3. **用户封禁（FR-A-001-03）**

   - 封禁违规用户
   - 设置封禁原因
   - 解除封禁

4. **角色管理（FR-A-001-04）**
   - 设置用户为管理员
   - 取消管理员权限

**输入**：搜索条件、封禁操作  
**输出**：用户列表、操作成功提示  
**优先级**：高

---

#### 3.2.2 问卷审核模块

**需求编号**：FR-A-002  
**需求描述**：审核用户提交的问卷

**详细需求**：

1. **待审核列表（FR-A-002-01）**

   - 查看所有待审核问卷
   - 显示问卷标题、创建者、提交时间
   - 按提交时间排序

2. **问卷审核（FR-A-002-02）**

   - 查看问卷详情
   - 审核通过：问卷自动发布
   - 审核驳回：填写驳回原因

3. **已发布问卷管理（FR-A-002-03）**
   - 查看所有已发布问卷
   - 强制下架违规问卷
   - 删除问卷

**输入**：审核操作、驳回原因  
**输出**：审核结果、问卷状态更新  
**优先级**：高

---

#### 3.2.3 公告管理模块

**需求编号**：FR-A-003  
**需求描述**：发布和管理系统公告

**详细需求**：

1. **发布公告（FR-A-003-01）**

   - 设置公告标题
   - 编辑公告内容（支持富文本）
   - 上传公告图片
   - 设置公告级别（普通、重要）

2. **公告管理（FR-A-003-02）**

   - 查看公告列表
   - 编辑公告
   - 删除公告

3. **公告展示（FR-A-003-03）**
   - 公告在首页显示
   - 重要公告置顶
   - 用户可关闭公告

**输入**：公告标题、内容  
**输出**：公告发布成功  
**优先级**：中

---

#### 3.2.4 数据统计模块

**需求编号**：FR-A-004  
**需求描述**：查看系统整体数据统计

**详细需求**：

1. **用户统计（FR-A-004-01）**

   - 总用户数
   - 新增用户数（日、周、月）
   - 活跃用户数
   - 用户增长趋势图

2. **问卷统计（FR-A-004-02）**

   - 总问卷数
   - 新增问卷数
   - 问卷分类分布
   - 问卷完成率统计

3. **答题统计（FR-A-004-03）**

   - 总答题数
   - 日答题量
   - 热门问卷排行

4. **数据可视化（FR-A-004-04）**
   - 使用 ECharts 展示图表
   - 折线图（用户增长趋势）
   - 饼图（问卷分类分布）
   - 柱状图（答题统计）

**输入**：时间范围  
**输出**：统计数据和图表  
**优先级**：中

---

## 第四章 性能需求分析

### 4.1 响应时间要求

| 操作         | 响应时间要求 |
| ------------ | ------------ |
| 页面加载     | ≤ 3 秒       |
| 问卷列表查询 | ≤ 1 秒       |
| 问卷提交     | ≤ 2 秒       |
| AI 报告生成  | ≤ 10 秒      |
| 搜索查询     | ≤ 1 秒       |
| 数据统计     | ≤ 2 秒       |

### 4.2 并发性能要求

- **同时在线用户数**：≥ 1000 人
- **并发答题数**：≥ 500 人
- **数据库连接池**：最大连接数 100

### 4.3 数据存储要求

- **数据库容量**：初期 50GB，可扩展至 500GB
- **单个问卷大小**：≤ 1MB
- **用户头像大小**：≤ 5MB
- **报告 PDF 大小**：≤ 10MB

### 4.4 可靠性要求

- **系统可用性**：≥ 99%
- **数据备份**：每日自动备份
- **故障恢复时间**：≤ 1 小时

---

## 第五章 非功能需求分析

### 5.1 安全性需求

1. **身份认证**：

   - JWT Token 认证
   - Token 有效期 7 天
   - 刷新 Token 机制

2. **密码安全**：

   - bcrypt 加密存储
   - 密码强度校验
   - 防暴力破解（登录失败 5 次锁定 30 分钟）

3. **数据安全**：

   - HTTPS 加密传输
   - SQL 注入防护（使用 ORM）
   - XSS 攻击防护
   - CSRF 防护

4. **权限控制**：
   - 基于角色的访问控制（RBAC）
   - 接口权限验证
   - 敏感操作二次确认

### 5.2 易用性需求

1. **界面设计**：

   - 简洁直观的 UI
   - 符合用户操作习惯
   - 响应式设计，适配 PC、平板、手机

2. **操作反馈**：

   - 操作成功/失败提示
   - 加载状态提示
   - 表单错误提示

3. **帮助文档**：
   - 在线帮助文档
   - 常见问题 FAQ
   - 操作指南

### 5.3 兼容性需求

1. **浏览器兼容**：

   - Chrome 90+
   - Firefox 88+
   - Safari 14+
   - Edge 90+

2. **设备兼容**：

   - PC 端（Windows、macOS、Linux）
   - 移动端（iOS、Android）
   - 平板（iPad、Android 平板）

3. **分辨率适配**：
   - 最低支持 1280×720
   - 最佳体验 1920×1080

### 5.4 可维护性需求

1. **代码规范**：

   - 遵循 ESLint 代码规范
   - 统一的命名规范
   - 充分的代码注释

2. **模块化设计**：

   - 组件化开发
   - 功能模块解耦
   - API 接口统一管理

3. **日志记录**：
   - 操作日志
   - 错误日志
   - 访问日志

### 5.5 可扩展性需求

1. **架构设计**：

   - 前后端分离
   - 微服务架构（可选）
   - 水平扩展支持

2. **功能扩展**：
   - 预留新题型接口
   - 预留第三方登录接口
   - 预留支付接口（积分兑换）

---

## 第六章 数据需求分析

### 6.1 数据实体

#### 6.1.1 用户（User）

| 字段名    | 类型         | 说明         | 约束          |
| --------- | ------------ | ------------ | ------------- |
| id        | INT          | 用户 ID      | 主键、自增    |
| username  | VARCHAR(50)  | 用户名       | 唯一、非空    |
| email     | VARCHAR(100) | 邮箱         | 唯一、非空    |
| password  | VARCHAR(255) | 密码（加密） | 非空          |
| nickname  | VARCHAR(50)  | 昵称         | -             |
| avatar    | VARCHAR(255) | 头像 URL     | -             |
| bio       | TEXT         | 个人简介     | -             |
| points    | INT          | 积分         | 默认 0        |
| level     | INT          | 等级         | 默认 1        |
| role      | ENUM         | 角色         | user/admin    |
| status    | ENUM         | 状态         | active/banned |
| createdAt | DATETIME     | 创建时间     | -             |
| updatedAt | DATETIME     | 更新时间     | -             |

#### 6.1.2 问卷（Survey）

| 字段名        | 类型         | 说明             | 约束                                    |
| ------------- | ------------ | ---------------- | --------------------------------------- |
| id            | INT          | 问卷 ID          | 主键、自增                              |
| userId        | INT          | 创建者 ID        | 外键                                    |
| title         | VARCHAR(200) | 问卷标题         | 非空                                    |
| description   | TEXT         | 问卷描述         | -                                       |
| categoryId    | INT          | 分类 ID          | 外键                                    |
| coverImage    | VARCHAR(255) | 封面图           | -                                       |
| duration      | INT          | 预计时长（分钟） | -                                       |
| questions     | JSON         | 题目数据         | -                                       |
| logic         | JSON         | 跳转逻辑         | -                                       |
| status        | ENUM         | 状态             | draft/pending/published/stopped/deleted |
| participants  | INT          | 参与人数         | 默认 0                                  |
| rating        | DECIMAL(3,2) | 平均评分         | -                                       |
| isTimeLimited | BOOLEAN      | 是否限时         | 默认 false                              |
| timeLimit     | INT          | 限时时长（秒）   | -                                       |
| createdAt     | DATETIME     | 创建时间         | -                                       |
| publishedAt   | DATETIME     | 发布时间         | -                                       |

#### 6.1.3 答案（Answer）

| 字段名    | 类型         | 说明           | 约束       |
| --------- | ------------ | -------------- | ---------- |
| id        | INT          | 答案 ID        | 主键、自增 |
| surveyId  | INT          | 问卷 ID        | 外键       |
| userId    | INT          | 答题者 ID      | 外键       |
| answers   | JSON         | 答案数据       | -          |
| score     | DECIMAL(5,2) | 得分           | -          |
| duration  | INT          | 答题时长（秒） | -          |
| createdAt | DATETIME     | 提交时间       | -          |

#### 6.1.4 评论（Comment）

| 字段名    | 类型     | 说明      | 约束       |
| --------- | -------- | --------- | ---------- |
| id        | INT      | 评论 ID   | 主键、自增 |
| surveyId  | INT      | 问卷 ID   | 外键       |
| userId    | INT      | 评论者 ID | 外键       |
| content   | TEXT     | 评论内容  | 非空       |
| parentId  | INT      | 父评论 ID | -          |
| createdAt | DATETIME | 评论时间  | -          |

#### 6.1.5 收藏（Favorite）

| 字段名    | 类型     | 说明     | 约束       |
| --------- | -------- | -------- | ---------- |
| id        | INT      | 收藏 ID  | 主键、自增 |
| userId    | INT      | 用户 ID  | 外键       |
| surveyId  | INT      | 问卷 ID  | 外键       |
| createdAt | DATETIME | 收藏时间 | -          |

#### 6.1.6 徽章（Badge）

| 字段名      | 类型         | 说明     | 约束       |
| ----------- | ------------ | -------- | ---------- |
| id          | INT          | 徽章 ID  | 主键、自增 |
| name        | VARCHAR(50)  | 徽章名称 | 非空       |
| description | TEXT         | 徽章描述 | -          |
| icon        | VARCHAR(255) | 徽章图标 | -          |
| condition   | JSON         | 解锁条件 | -          |

#### 6.1.7 用户徽章（UserBadge）

| 字段名     | 类型     | 说明     | 约束       |
| ---------- | -------- | -------- | ---------- |
| id         | INT      | ID       | 主键、自增 |
| userId     | INT      | 用户 ID  | 外键       |
| badgeId    | INT      | 徽章 ID  | 外键       |
| unlockedAt | DATETIME | 解锁时间 | -          |

#### 6.1.8 积分历史（PointHistory）

| 字段名    | 类型         | 说明     | 约束       |
| --------- | ------------ | -------- | ---------- |
| id        | INT          | ID       | 主键、自增 |
| userId    | INT          | 用户 ID  | 外键       |
| points    | INT          | 积分变化 | -          |
| reason    | VARCHAR(100) | 原因     | -          |
| createdAt | DATETIME     | 时间     | -          |

#### 6.1.9 AI 报告（Report）

| 字段名    | 类型         | 说明         | 约束       |
| --------- | ------------ | ------------ | ---------- |
| id        | INT          | 报告 ID      | 主键、自增 |
| answerId  | INT          | 答案 ID      | 外键       |
| userId    | INT          | 用户 ID      | 外键       |
| surveyId  | INT          | 问卷 ID      | 外键       |
| content   | JSON         | 报告内容     | -          |
| pdfUrl    | VARCHAR(255) | PDF 下载链接 | -          |
| createdAt | DATETIME     | 生成时间     | -          |

### 6.2 数据关系

```
User 1:N Survey        (一个用户可创建多个问卷)
User 1:N Answer        (一个用户可填写多个问卷)
User 1:N Comment       (一个用户可发表多条评论)
User 1:N Favorite      (一个用户可收藏多个问卷)
User M:N Badge         (通过UserBadge关联)

Survey 1:N Answer      (一个问卷可被多人填写)
Survey 1:N Comment     (一个问卷可有多条评论)
Survey 1:N Favorite    (一个问卷可被多人收藏)

Answer 1:1 Report      (一份答卷对应一份报告)
```

---

## 第七章 接口需求分析

### 7.1 前后端接口

**基础 URL**：`http://localhost:3000/api`

#### 7.1.1 认证接口

| 接口                 | 方法 | 说明       | 权限   |
| -------------------- | ---- | ---------- | ------ |
| /auth/register       | POST | 用户注册   | 公开   |
| /auth/login          | POST | 用户登录   | 公开   |
| /auth/logout         | POST | 用户登出   | 需登录 |
| /auth/refresh        | POST | 刷新 Token | 需登录 |
| /auth/reset-password | POST | 重置密码   | 公开   |

#### 7.1.2 用户接口

| 接口            | 方法 | 说明         | 权限   |
| --------------- | ---- | ------------ | ------ |
| /users/profile  | GET  | 获取个人信息 | 需登录 |
| /users/profile  | PUT  | 更新个人信息 | 需登录 |
| /users/avatar   | POST | 上传头像     | 需登录 |
| /users/password | PUT  | 修改密码     | 需登录 |
| /users/points   | GET  | 获取积分历史 | 需登录 |
| /users/badges   | GET  | 获取成就徽章 | 需登录 |
| /users/surveys  | GET  | 获取我的问卷 | 需登录 |
| /users/answers  | GET  | 获取答题历史 | 需登录 |

#### 7.1.3 问卷接口

| 接口                 | 方法   | 说明         | 权限          |
| -------------------- | ------ | ------------ | ------------- |
| /surveys             | GET    | 获取问卷列表 | 公开          |
| /surveys/:id         | GET    | 获取问卷详情 | 公开          |
| /surveys             | POST   | 创建问卷     | 需登录        |
| /surveys/:id         | PUT    | 更新问卷     | 创建者/管理员 |
| /surveys/:id         | DELETE | 删除问卷     | 创建者/管理员 |
| /surveys/:id/publish | POST   | 发布问卷     | 创建者        |
| /surveys/:id/stop    | POST   | 停止问卷     | 创建者        |
| /surveys/:id/stats   | GET    | 获取统计数据 | 创建者/管理员 |
| /surveys/search      | GET    | 搜索问卷     | 公开          |
| /surveys/recommend   | GET    | 个性化推荐   | 需登录        |

#### 7.1.4 答题接口

| 接口         | 方法 | 说明         | 权限   |
| ------------ | ---- | ------------ | ------ |
| /answers     | POST | 提交答案     | 需登录 |
| /answers/:id | GET  | 获取答案详情 | 需登录 |

#### 7.1.5 AI 报告接口

| 接口                  | 方法 | 说明          | 权限   |
| --------------------- | ---- | ------------- | ------ |
| /reports/generate     | POST | 生成 AI 报告  | 需登录 |
| /reports/:id          | GET  | 获取报告详情  | 需登录 |
| /reports/:id/download | GET  | 下载 PDF 报告 | 需登录 |
| /reports              | GET  | 获取报告列表  | 需登录 |

#### 7.1.6 社交接口

| 接口                  | 方法   | 说明         | 权限          |
| --------------------- | ------ | ------------ | ------------- |
| /favorites            | POST   | 收藏问卷     | 需登录        |
| /favorites/:id        | DELETE | 取消收藏     | 需登录        |
| /favorites            | GET    | 获取收藏列表 | 需登录        |
| /comments             | POST   | 发表评论     | 需登录        |
| /comments/:id         | DELETE | 删除评论     | 创建者/管理员 |
| /surveys/:id/comments | GET    | 获取评论列表 | 公开          |
| /surveys/:id/rate     | POST   | 评分         | 需登录        |

#### 7.1.7 管理员接口

| 接口                       | 方法 | 说明           | 权限   |
| -------------------------- | ---- | -------------- | ------ |
| /admin/users               | GET  | 获取用户列表   | 管理员 |
| /admin/users/:id/ban       | POST | 封禁用户       | 管理员 |
| /admin/surveys/pending     | GET  | 获取待审核问卷 | 管理员 |
| /admin/surveys/:id/approve | POST | 审核通过       | 管理员 |
| /admin/surveys/:id/reject  | POST | 审核驳回       | 管理员 |
| /admin/announcements       | POST | 发布公告       | 管理员 |
| /admin/stats               | GET  | 获取统计数据   | 管理员 |

### 7.2 第三方接口

#### 7.2.1 扣子平台（Coze）API

- **接口用途**：AI 报告生成
- **调用方式**：RESTful API
- **认证方式**：API Key
- **请求格式**：JSON
- **响应格式**：JSON

---

## 第八章 约束与限制

### 8.1 技术约束

1. **前端框架**：必须使用 Vue 3
2. **后端框架**：必须使用 Node.js + Express
3. **数据库**：必须使用 MySQL
4. **AI 服务**：使用扣子平台 API

### 8.2 开发约束

1. **开发周期**：约 3-4 个月
2. **开发人员**：1-2 人
3. **开发工具**：VS Code
4. **版本控制**：Git

### 8.3 运营约束

1. **初期用户规模**：预计 500-1000 人
2. **数据存储**：初期 50GB
3. **服务器成本**：控制在合理范围

---

## 第九章 验收标准

### 9.1 功能验收

- ✅ 所有核心功能模块正常运行
- ✅ 用户能够完成注册、登录、答题、创建问卷全流程
- ✅ AI 报告生成功能正常
- ✅ 游戏化动画效果流畅展示

### 9.2 性能验收

- ✅ 页面加载时间 ≤ 3 秒
- ✅ 接口响应时间符合要求
- ✅ 支持 1000 人同时在线

### 9.3 安全验收

- ✅ 通过基本安全测试（SQL 注入、XSS 等）
- ✅ 密码加密存储
- ✅ Token 认证机制正常

### 9.4 兼容性验收

- ✅ 主流浏览器（Chrome、Firefox、Safari、Edge）正常运行
- ✅ PC 端和移动端正常显示

---

## 第十章 附录

### 10.1 需求变更记录

| 版本 | 日期       | 变更内容 | 变更人 |
| ---- | ---------- | -------- | ------ |
| v1.0 | 2025-12-02 | 初始版本 | 项目组 |

### 10.2 参考文档

1. 《软件需求工程》（第 2 版）
2. 《用户体验要素》
3. Vue 3 官方文档
4. Element Plus 官方文档

### 10.3 术语表

详见第 1.3 节

---

**文档结束**

**审批记录**：

| 角色   | 姓名 | 日期       | 签名 |
| ------ | ---- | ---------- | ---- |
| 编写人 | -    | 2025-12-02 | -    |
| 审核人 | -    | -          | -    |
| 批准人 | -    | -          | -    |
